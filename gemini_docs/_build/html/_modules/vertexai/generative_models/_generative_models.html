

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vertexai.generative_models._generative_models &#8212; google-cloud-aiplatform  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
          	<div class="admonition" id="python2-eol"> 
          	 As of January 1, 2020 this library no longer supports Python 2 on the latest released version. 
          	 Library versions released prior to that date will continue to be available. For more information please
          	 visit <a href="https://cloud.google.com/python/docs/python2-sunset/">Python 2 support on Google Cloud</a>.
          	</div>
            
  <h1>Source code for vertexai.generative_models._generative_models</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2023 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot;Classes for working with generative models.&quot;&quot;&quot;</span>
<span class="c1"># pylint: disable=bad-continuation, line-too-long, protected-access</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">AsyncIterable</span><span class="p">,</span>
    <span class="n">Awaitable</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Dict</span><span class="p">,</span>
    <span class="n">Iterable</span><span class="p">,</span>
    <span class="n">List</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
    <span class="n">Union</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">google.cloud.aiplatform</span> <span class="kn">import</span> <span class="n">initializer</span> <span class="k">as</span> <span class="n">aiplatform_initializer</span>
<span class="kn">from</span> <span class="nn">google.cloud.aiplatform</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">aiplatform_utils</span>
<span class="kn">from</span> <span class="nn">google.cloud.aiplatform_v1beta1</span> <span class="kn">import</span> <span class="n">types</span> <span class="k">as</span> <span class="n">aiplatform_types</span>
<span class="kn">from</span> <span class="nn">google.cloud.aiplatform_v1beta1.services</span> <span class="kn">import</span> <span class="n">prediction_service</span>
<span class="kn">from</span> <span class="nn">google.cloud.aiplatform_v1beta1.types</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">content</span> <span class="k">as</span> <span class="n">gapic_content_types</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">google.cloud.aiplatform_v1beta1.types</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">prediction_service</span> <span class="k">as</span> <span class="n">gapic_prediction_service_types</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">google.cloud.aiplatform_v1beta1.types</span> <span class="kn">import</span> <span class="n">tool</span> <span class="k">as</span> <span class="n">gapic_tool_types</span>
<span class="kn">from</span> <span class="nn">google.protobuf</span> <span class="kn">import</span> <span class="n">json_format</span>
<span class="kn">from</span> <span class="nn">vertexai.preview</span> <span class="kn">import</span> <span class="n">rag</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">PIL_Image</span>  <span class="c1"># pylint: disable=g-import-not-at-top</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PIL_Image</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Re-exporting some GAPIC types</span>

<span class="c1"># GAPIC types used in request</span>
<span class="n">HarmCategory</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">HarmCategory</span>
<span class="n">HarmBlockThreshold</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="o">.</span><span class="n">HarmBlockThreshold</span>
<span class="c1"># GAPIC types used in response</span>
<span class="c1"># We expose FinishReason to make it easier to check the response finish reason.</span>
<span class="n">FinishReason</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span>
<span class="c1"># We expose SafetyRating to make it easier to check the response safety rating.</span>
<span class="n">SafetyRating</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetyRating</span>


<span class="c1"># These type defnitions are expanded to help the user see all the types</span>
<span class="n">PartsType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;Image&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Part&quot;</span><span class="p">,</span>
    <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="s2">&quot;Part&quot;</span><span class="p">]],</span>
<span class="p">]</span>

<span class="n">ContentDict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="n">ContentsType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">],</span>
    <span class="n">List</span><span class="p">[</span><span class="n">ContentDict</span><span class="p">],</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;Image&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Part&quot;</span><span class="p">,</span>
    <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="s2">&quot;Part&quot;</span><span class="p">]],</span>
<span class="p">]</span>

<span class="n">GenerationConfigDict</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="n">GenerationConfigType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="s2">&quot;GenerationConfig&quot;</span><span class="p">,</span>
    <span class="n">GenerationConfigDict</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">SafetySettingsType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="n">List</span><span class="p">[</span><span class="s2">&quot;SafetySetting&quot;</span><span class="p">],</span>
    <span class="n">Dict</span><span class="p">[</span>
        <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">HarmCategory</span><span class="p">,</span>
        <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="o">.</span><span class="n">HarmBlockThreshold</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]</span>


<span class="k">class</span> <span class="nc">_GenerativeModel</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A model that can generate content.</span>


<span class="sd">    Usage:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(&quot;gemini-pro&quot;)</span>
<span class="sd">        response = model.generate_content(</span>
<span class="sd">            contents=&quot;Why is sky blue?&quot;,</span>
<span class="sd">            # Optional:</span>
<span class="sd">            generation_config=GenerationConfig(</span>
<span class="sd">                temperature=0.1,</span>
<span class="sd">                top_p=0.95,</span>
<span class="sd">                top_k=20,</span>
<span class="sd">                candidate_count=1,</span>
<span class="sd">                max_output_tokens=100,</span>
<span class="sd">                stop_sequences=[&quot;STOP!&quot;],</span>
<span class="sd">            ),</span>
<span class="sd">            safety_settings={</span>
<span class="sd">                HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT: HarmBlockThreshold.BLOCK_ONLY_HIGH,</span>
<span class="sd">                HarmCategory.HARM_CATEGORY_HATE_SPEECH: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE,</span>
<span class="sd">                HarmCategory.HARM_CATEGORY_HARASSMENT: HarmBlockThreshold.BLOCK_LOW_AND_ABOVE,</span>
<span class="sd">                HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT: HarmBlockThreshold.BLOCK_NONE,</span>
<span class="sd">            }</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_USER_ROLE</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
    <span class="n">_MODEL_ROLE</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">system_instruction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PartsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initializes GenerativeModel.</span>

<span class="sd">        Usage:</span>
<span class="sd">            ```</span>
<span class="sd">            model = GenerativeModel(&quot;gemini-pro&quot;)</span>
<span class="sd">            print(model.generate_content(&quot;Hello&quot;))</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name: Model Garden model resource name.</span>
<span class="sd">                Alternatively, a tuned model endpoint resource name can be provided.</span>
<span class="sd">            generation_config: Default generation config to use in generate_content.</span>
<span class="sd">            safety_settings: Default safety settings to use in generate_content.</span>
<span class="sd">            tools: Default tools to use in generate_content.</span>
<span class="sd">            tool_config: Default tool config to use in generate_content.</span>
<span class="sd">            system_instruction: Default system instruction to use in generate_content.</span>
<span class="sd">                Note: Only text should be used in parts.</span>
<span class="sd">                Content of each part will become a separate paragraph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;model_name must not be empty&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_name</span><span class="p">:</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;publishers/google/models/&quot;</span> <span class="o">+</span> <span class="n">model_name</span>
        <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;models/&quot;</span><span class="p">):</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;publishers/google/&quot;</span> <span class="o">+</span> <span class="n">model_name</span>

        <span class="n">project</span> <span class="o">=</span> <span class="n">aiplatform_initializer</span><span class="o">.</span><span class="n">global_config</span><span class="o">.</span><span class="n">project</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">aiplatform_initializer</span><span class="o">.</span><span class="n">global_config</span><span class="o">.</span><span class="n">location</span>

        <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;publishers/&quot;</span><span class="p">):</span>
            <span class="n">prediction_resource_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="n">project</span><span class="si">}</span><span class="s2">/locations/</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;projects/&quot;</span><span class="p">):</span>
            <span class="n">prediction_resource_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;model_name must be either a Model Garden model ID or a full resource name.&quot;</span>
            <span class="p">)</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">aiplatform_utils</span><span class="o">.</span><span class="n">extract_project_and_location_from_parent</span><span class="p">(</span>
            <span class="n">prediction_resource_name</span>
        <span class="p">)[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_resource_name</span> <span class="o">=</span> <span class="n">prediction_resource_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generation_config</span> <span class="o">=</span> <span class="n">generation_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_safety_settings</span> <span class="o">=</span> <span class="n">safety_settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="n">tools</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tool_config</span> <span class="o">=</span> <span class="n">tool_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_system_instruction</span> <span class="o">=</span> <span class="n">system_instruction</span>

        <span class="c1"># Validating the parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
            <span class="n">system_instruction</span><span class="o">=</span><span class="n">system_instruction</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_prediction_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">prediction_service</span><span class="o">.</span><span class="n">PredictionServiceClient</span><span class="p">:</span>
        <span class="c1"># Switch to @functools.cached_property once its available.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_prediction_client_value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_client_value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">aiplatform_initializer</span><span class="o">.</span><span class="n">global_config</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span>
                    <span class="n">client_class</span><span class="o">=</span><span class="n">prediction_service</span><span class="o">.</span><span class="n">PredictionServiceClient</span><span class="p">,</span>
                    <span class="n">location_override</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span>
                    <span class="n">prediction_client</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_client_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_prediction_async_client</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">prediction_service</span><span class="o">.</span><span class="n">PredictionServiceAsyncClient</span><span class="p">:</span>
        <span class="c1"># Switch to @functools.cached_property once its available.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_prediction_async_client_value&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_async_client_value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">aiplatform_initializer</span><span class="o">.</span><span class="n">global_config</span><span class="o">.</span><span class="n">create_client</span><span class="p">(</span>
                    <span class="n">client_class</span><span class="o">=</span><span class="n">prediction_service</span><span class="o">.</span><span class="n">PredictionServiceAsyncClient</span><span class="p">,</span>
                    <span class="n">location_override</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span>
                    <span class="n">prediction_client</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_async_client_value</span>

    <span class="k">def</span> <span class="nf">_prepare_request</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">system_instruction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PartsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentRequest</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepares a GAPIC GenerateContentRequest.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;contents must not be empty&quot;</span><span class="p">)</span>

        <span class="n">generation_config</span> <span class="o">=</span> <span class="n">generation_config</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generation_config</span>
        <span class="n">safety_settings</span> <span class="o">=</span> <span class="n">safety_settings</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safety_settings</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="n">tools</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span>
        <span class="n">tool_config</span> <span class="o">=</span> <span class="n">tool_config</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tool_config</span>
        <span class="n">system_instruction</span> <span class="o">=</span> <span class="n">system_instruction</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_system_instruction</span>

        <span class="c1"># contents can either be a list of Content objects (most generic case)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;When passing a list with Content objects, every item in a list must be a Content object.&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Content</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Content</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;When passing a list with Content objects, every item in a list must be a Content object.&quot;</span>
                <span class="p">)</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="o">.</span><span class="n">_raw_content</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;When passing a list with Content dict objects, every item in a list must be a Content dict object.&quot;</span>
                <span class="p">)</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span><span class="n">content_dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">content_dict</span> <span class="ow">in</span> <span class="n">contents</span>
            <span class="p">]</span>
        <span class="c1"># or a value that can be converted to a *single* Content object</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="n">_to_content</span><span class="p">(</span><span class="n">contents</span><span class="p">)]</span>

        <span class="n">gapic_system_instruction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">system_instruction</span><span class="p">:</span>
            <span class="n">gapic_system_instruction</span> <span class="o">=</span> <span class="n">_to_content</span><span class="p">(</span><span class="n">system_instruction</span><span class="p">)</span>

        <span class="n">gapic_generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GenerationConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">generation_config</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generation_config</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GenerationConfig</span><span class="p">):</span>
                <span class="n">gapic_generation_config</span> <span class="o">=</span> <span class="n">generation_config</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generation_config</span><span class="p">,</span> <span class="n">GenerationConfig</span><span class="p">):</span>
                <span class="n">gapic_generation_config</span> <span class="o">=</span> <span class="n">generation_config</span><span class="o">.</span><span class="n">_raw_generation_config</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generation_config</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
                <span class="n">gapic_generation_config</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GenerationConfig</span><span class="p">(</span>
                    <span class="o">**</span><span class="n">generation_config</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;generation_config must either be a GenerationConfig object or a dictionary representation of it.&quot;</span>
                <span class="p">)</span>

        <span class="n">gapic_safety_settings</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">safety_settings</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">safety_settings</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
                <span class="n">gapic_safety_settings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">safety_setting</span> <span class="ow">in</span> <span class="n">safety_settings</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">safety_setting</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="p">):</span>
                        <span class="n">gapic_safety_settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safety_setting</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">safety_setting</span><span class="p">,</span> <span class="n">SafetySetting</span><span class="p">):</span>
                        <span class="n">gapic_safety_settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">safety_setting</span><span class="o">.</span><span class="n">_raw_safety_setting</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;When passing a list with SafetySettings objects, every item in a list must be a SafetySetting object.&quot;</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">safety_settings</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">gapic_safety_settings</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="p">(</span>
                        <span class="n">category</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">HarmCategory</span><span class="p">(</span><span class="n">category</span><span class="p">),</span>
                        <span class="n">threshold</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="o">.</span><span class="n">HarmBlockThreshold</span><span class="p">(</span>
                            <span class="n">threshold</span>
                        <span class="p">),</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">safety_settings</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;safety_settings must either be a list of SafetySettings objects or a dictionary mapping from HarmCategory to HarmBlockThreshold.&quot;</span>
                <span class="p">)</span>

        <span class="n">gapic_tools</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">tools</span><span class="p">:</span>
            <span class="n">gapic_tools</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span><span class="p">):</span>
                    <span class="n">gapic_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">Tool</span><span class="p">):</span>
                    <span class="n">gapic_tools</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">_raw_tool</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected tool type: </span><span class="si">{</span><span class="n">tool</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">gapic_tool_config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">tool_config</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool_config</span><span class="p">,</span> <span class="n">ToolConfig</span><span class="p">):</span>
                <span class="n">gapic_tool_config</span> <span class="o">=</span> <span class="n">tool_config</span><span class="o">.</span><span class="n">_gapic_tool_config</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;tool_config must be a ToolConfig object.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentRequest</span><span class="p">(</span>
            <span class="c1"># The `model` parameter now needs to be set for the vision models.</span>
            <span class="c1"># Always need to pass the resource via the `model` parameter.</span>
            <span class="c1"># Even when resource is an endpoint.</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_resource_name</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">gapic_generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">gapic_safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">gapic_tools</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">gapic_tool_config</span><span class="p">,</span>
            <span class="n">system_instruction</span><span class="o">=</span><span class="n">gapic_system_instruction</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_response</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">response</span><span class="p">:</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GenerationResponse</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_content</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">],]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            tool_config: Config shared for all tools provided in the request.</span>
<span class="sd">            stream: Whether to stream the response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A single GenerationResponse object if stream == False</span>
<span class="sd">            A stream of GenerationResponse objects if stream == True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream</span><span class="p">:</span>
            <span class="c1"># TODO(b/315810992): Surface prompt_feedback on the returned stream object</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_streaming</span><span class="p">(</span>
                <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
                <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_content</span><span class="p">(</span>
                <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
                <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">generate_content_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">,</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">],]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            tool_config: Config shared for all tools provided in the request.</span>
<span class="sd">            stream: Whether to stream the response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An awaitable for a single GenerationResponse object if stream == False</span>
<span class="sd">            An awaitable for a stream of GenerationResponse objects if stream == True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_streaming_async</span><span class="p">(</span>
                <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
                <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_content_async</span><span class="p">(</span>
                <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
                <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_content</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            tool_config: Config shared for all tools provided in the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A single GenerationResponse object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gapic_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_client</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response</span><span class="p">(</span><span class="n">gapic_response</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_generate_content_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            tool_config: Config shared for all tools provided in the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An awaitable for a single GenerationResponse object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gapic_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_async_client</span><span class="o">.</span><span class="n">generate_content</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="n">request</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response</span><span class="p">(</span><span class="n">gapic_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_content_streaming</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            tool_config: Config shared for all tools provided in the request.</span>

<span class="sd">        Yields:</span>
<span class="sd">            A stream of GenerationResponse objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_client</span><span class="o">.</span><span class="n">stream_generate_content</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="n">request</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response_stream</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_generate_content_streaming_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tool_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ToolConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            tool_config: Config shared for all tools provided in the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An awaitable for a stream of GenerationResponse objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">tool_config</span><span class="o">=</span><span class="n">tool_config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response_stream</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_async_client</span><span class="o">.</span><span class="n">stream_generate_content</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="n">request</span>
        <span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">async_generator</span><span class="p">():</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response_stream</span><span class="p">:</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">async_generator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">count_tokens</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">CountTokensResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts tokens.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>

<span class="sd">        Returns:</span>
<span class="sd">            A CountTokensResponse object that has the following attributes:</span>
<span class="sd">                total_tokens: The total number of tokens counted across all instances from the request.</span>
<span class="sd">                total_billable_characters: The total number of billable characters counted across all instances from the request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_client</span><span class="o">.</span><span class="n">count_tokens</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">CountTokensRequest</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_resource_name</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_resource_name</span><span class="p">,</span>
                <span class="n">contents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span><span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">count_tokens_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="n">ContentsType</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">CountTokensResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts tokens asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            contents: Contents to send to the model.</span>
<span class="sd">                Supports either a list of Content objects (passing a multi-turn conversation)</span>
<span class="sd">                or a value that can be converted to a single Content object (passing a single message).</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">                * List[Content]</span>

<span class="sd">        Returns:</span>
<span class="sd">            And awaitable for a CountTokensResponse object that has the following attributes:</span>
<span class="sd">                total_tokens: The total number of tokens counted across all instances from the request.</span>
<span class="sd">                total_billable_characters: The total number of billable characters counted across all instances from the request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prediction_async_client</span><span class="o">.</span><span class="n">count_tokens</span><span class="p">(</span>
            <span class="n">request</span><span class="o">=</span><span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">CountTokensRequest</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_resource_name</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prediction_resource_name</span><span class="p">,</span>
                <span class="n">contents</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_prepare_request</span><span class="p">(</span><span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_chat</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChatSession&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a stateful chat session.</span>

<span class="sd">        Args:</span>
<span class="sd">            history: Previous history to initialize the chat session.</span>
<span class="sd">            response_validation: Whether to validate responses before adding</span>
<span class="sd">                them to chat history. By default, `send_message` will raise</span>
<span class="sd">                error if the request or response is blocked or if the response</span>
<span class="sd">                is incomplete due to going over the max token limit.</span>
<span class="sd">                If set to `False`, the chat session history will always</span>
<span class="sd">                accumulate the request and response messages even if the</span>
<span class="sd">                reponse if blocked or incomplete. This can result in an unusable</span>
<span class="sd">                chat session state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A ChatSession object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ChatSession</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
            <span class="n">response_validation</span><span class="o">=</span><span class="n">response_validation</span><span class="p">,</span>
        <span class="p">)</span>


<span class="n">_SUCCESSFUL_FINISH_REASONS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="o">.</span><span class="n">STOP</span><span class="p">,</span>
    <span class="c1"># Many responses have this finish reason</span>
    <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="o">.</span><span class="n">FINISH_REASON_UNSPECIFIED</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">def</span> <span class="nf">_validate_response</span><span class="p">(</span>
    <span class="n">response</span><span class="p">:</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">,</span>
    <span class="n">request_contents</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">response_chunks</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The model response was blocked due to </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">_raw_response</span><span class="o">.</span><span class="n">prompt_feedback</span><span class="o">.</span><span class="n">block_reason</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Blocke reason message: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">_raw_response</span><span class="o">.</span><span class="n">prompt_feedback</span><span class="o">.</span><span class="n">block_reason_message</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">candidate</span><span class="o">.</span><span class="n">finish_reason</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_SUCCESSFUL_FINISH_REASONS</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;The model response did not completed successfully.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Finish reason: </span><span class="si">{</span><span class="n">candidate</span><span class="o">.</span><span class="n">finish_reason</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Finish message: </span><span class="si">{</span><span class="n">candidate</span><span class="o">.</span><span class="n">finish_message</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Safety ratings: </span><span class="si">{</span><span class="n">candidate</span><span class="o">.</span><span class="n">safety_ratings</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;To protect the integrity of the chat session, the request and response were not added to chat history.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;To skip the response validation, specify `model.start_chat(response_validation=False)`.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Note that letting blocked or otherwise incomplete responses into chat history might lead to future interactions being blocked by the service.&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ResponseValidationError</span><span class="p">(</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">request_contents</span><span class="o">=</span><span class="n">request_contents</span><span class="p">,</span>
            <span class="n">responses</span><span class="o">=</span><span class="n">response_chunks</span><span class="p">,</span>
        <span class="p">)</span>


<div class="viewcode-block" id="ChatSession"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.ChatSession">[docs]</a><span class="k">class</span> <span class="nc">ChatSession</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Chat session holds the chat history.&quot;&quot;&quot;</span>

    <span class="n">_USER_ROLE</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
    <span class="n">_MODEL_ROLE</span> <span class="o">=</span> <span class="s2">&quot;model&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">_GenerativeModel</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">history</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Content</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">history</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;history must be a list of Content objects.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">=</span> <span class="n">history</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span> <span class="o">=</span> <span class="n">_validate_response</span> <span class="k">if</span> <span class="n">response_validation</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="c1"># _responder is currently only set by PreviewChatSession</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_responder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;AutomaticFunctionCallingResponder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span>

<div class="viewcode-block" id="ChatSession.send_message"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.ChatSession.send_message">[docs]</a>    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="n">PartsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Content to send to the model.</span>
<span class="sd">                Supports a value that can be converted to a Part or a list of such values.</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            stream: Whether to stream the response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A single GenerationResponse object if stream == False</span>
<span class="sd">            A stream of GenerationResponse objects if stream == True</span>

<span class="sd">        Raises:</span>
<span class="sd">            ResponseValidationError: If the response was blocked or is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_message_streaming</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ChatSession.send_message_async"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.ChatSession.send_message_async">[docs]</a>    <span class="k">def</span> <span class="nf">send_message_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="n">PartsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Awaitable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">],</span>
        <span class="n">Awaitable</span><span class="p">[</span><span class="n">AsyncIterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Content to send to the model.</span>
<span class="sd">                Supports a value that can be converted to a Part or a list of such values.</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>
<span class="sd">            stream: Whether to stream the response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An awaitable for a single GenerationResponse object if stream == False</span>
<span class="sd">            An awaitable for a stream of GenerationResponse objects if stream == True</span>

<span class="sd">        Raises:</span>
<span class="sd">            ResponseValidationError: If the response was blocked or is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_message_streaming_async</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_message_async</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="n">content</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_send_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="n">PartsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Content to send to the model.</span>
<span class="sd">                Supports a value that can be converted to a Part or a list of such values.</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A single GenerationResponse object</span>

<span class="sd">        Raises:</span>
<span class="sd">            ResponseValidationError: If the response was blocked or is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preparing the message history to send</span>
        <span class="n">request_message</span> <span class="o">=</span> <span class="n">Content</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">_to_content</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_USER_ROLE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">history_delta</span> <span class="o">=</span> <span class="p">[</span><span class="n">request_message</span><span class="p">]</span>

        <span class="n">message_responder</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_responder</span><span class="o">.</span><span class="n">_create_responder_for_message</span><span class="p">(</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_tools</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_responder</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">request_history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_history</span> <span class="o">+</span> <span class="n">history_delta</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_generate_content</span><span class="p">(</span>
                <span class="n">contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># By default we&#39;re not adding incomplete interactions to history.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
                    <span class="n">request_contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
                    <span class="n">response_chunks</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span>
                <span class="p">)</span>

            <span class="c1"># Adding the request and the first response candidate to history</span>
            <span class="n">response_message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
            <span class="c1"># Response role is NOT set by the model.</span>
            <span class="n">response_message</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MODEL_ROLE</span>
            <span class="n">history_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_message</span><span class="p">)</span>

            <span class="n">auto_responder_content</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">message_responder</span><span class="o">.</span><span class="n">respond_to_model_response</span><span class="p">(</span><span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">message_responder</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">auto_responder_content</span><span class="p">:</span>
                <span class="n">auto_responder_content</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_USER_ROLE</span>
                <span class="n">history_delta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auto_responder_content</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">history_delta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_send_message_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="n">PartsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Content to send to the model.</span>
<span class="sd">                Supports a value that can be converted to a Part or a list of such values.</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An awaitable for a single GenerationResponse object</span>

<span class="sd">        Raises:</span>
<span class="sd">            ResponseValidationError: If the response was blocked or is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Preparing the message history to send</span>
        <span class="n">request_message</span> <span class="o">=</span> <span class="n">Content</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">_to_content</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_USER_ROLE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">request_history</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="n">request_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_message</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_generate_content_async</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># By default we&#39;re not adding incomplete interactions to history.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span><span class="p">(</span>
                <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
                <span class="n">request_contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
                <span class="n">response_chunks</span><span class="o">=</span><span class="p">[</span><span class="n">response</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Adding the request and the first response candidate to history</span>
        <span class="n">response_message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
        <span class="c1"># Response role is NOT set by the model.</span>
        <span class="n">response_message</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MODEL_ROLE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_send_message_streaming</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="n">PartsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Content to send to the model.</span>
<span class="sd">                Supports a value that can be converted to a Part or a list of such values.</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>

<span class="sd">        Yields:</span>
<span class="sd">            A stream of GenerationResponse objects</span>

<span class="sd">        Raises:</span>
<span class="sd">            ResponseValidationError: If the response was blocked or is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Preparing the message history to send</span>
        <span class="n">request_message</span> <span class="o">=</span> <span class="n">Content</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">_to_content</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_USER_ROLE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">request_history</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="n">request_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_message</span><span class="p">)</span>

        <span class="n">stream</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_generate_content_streaming</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">full_response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
            <span class="c1"># By default we&#39;re not adding incomplete interactions to history.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span><span class="p">(</span>
                    <span class="n">response</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
                    <span class="n">request_contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
                    <span class="n">response_chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">full_response</span><span class="p">:</span>
                <span class="n">_append_response</span><span class="p">(</span><span class="n">full_response</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">full_response</span> <span class="o">=</span> <span class="n">chunk</span>
            <span class="k">yield</span> <span class="n">chunk</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">full_response</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Adding the request and the first response candidate to history</span>
        <span class="n">response_message</span> <span class="o">=</span> <span class="n">full_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
        <span class="c1"># Response role is NOT set by the model.</span>
        <span class="n">response_message</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MODEL_ROLE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_message</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_send_message_streaming_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">content</span><span class="p">:</span> <span class="n">PartsType</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">generation_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GenerationConfigType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SafetySettingsType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tools</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Tool&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterable</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates content asynchronously.</span>

<span class="sd">        Args:</span>
<span class="sd">            content: Content to send to the model.</span>
<span class="sd">                Supports a value that can be converted to a Part or a list of such values.</span>
<span class="sd">                Supports</span>
<span class="sd">                * str, Image, Part,</span>
<span class="sd">                * List[Union[str, Image, Part]],</span>
<span class="sd">            generation_config: Parameters for the generation.</span>
<span class="sd">            safety_settings: Safety settings as a mapping from HarmCategory to HarmBlockThreshold.</span>
<span class="sd">            tools: A list of tools (functions) that the model can try calling.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An awaitable for a stream of GenerationResponse objects</span>

<span class="sd">        Raises:</span>
<span class="sd">            ResponseValidationError: If the response was blocked or is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Preparing the message history to send</span>
        <span class="n">request_message</span> <span class="o">=</span> <span class="n">Content</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">_to_content</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">content</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_USER_ROLE</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">request_history</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="p">)</span>
        <span class="n">request_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_message</span><span class="p">)</span>

        <span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_generate_content_streaming_async</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
            <span class="n">generation_config</span><span class="o">=</span><span class="n">generation_config</span><span class="p">,</span>
            <span class="n">safety_settings</span><span class="o">=</span><span class="n">safety_settings</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">async_generator</span><span class="p">():</span>
            <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">full_response</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
                <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="c1"># By default we&#39;re not adding incomplete interactions to history.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_response_validator</span><span class="p">(</span>
                        <span class="n">response</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span>
                        <span class="n">request_contents</span><span class="o">=</span><span class="n">request_history</span><span class="p">,</span>
                        <span class="n">response_chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">full_response</span><span class="p">:</span>
                    <span class="n">_append_response</span><span class="p">(</span><span class="n">full_response</span><span class="p">,</span> <span class="n">chunk</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">full_response</span> <span class="o">=</span> <span class="n">chunk</span>
                <span class="k">yield</span> <span class="n">chunk</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">full_response</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="c1"># Adding the request and the first response candidate to history</span>
            <span class="n">response_message</span> <span class="o">=</span> <span class="n">full_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">content</span>
            <span class="c1"># Response role is NOT set by the model.</span>
            <span class="n">response_message</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MODEL_ROLE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_message</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">async_generator</span><span class="p">()</span></div>


<span class="k">class</span> <span class="nc">_PreviewChatSession</span><span class="p">(</span><span class="n">ChatSession</span><span class="p">):</span>
    <span class="vm">__doc__</span> <span class="o">=</span> <span class="n">ChatSession</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="c1"># This class preserves backwards compatibility with the `raise_on_blocked` parameter.</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">_GenerativeModel</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1"># Preview features:</span>
        <span class="n">responder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;AutomaticFunctionCallingResponder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Deprecated</span>
        <span class="n">raise_on_blocked</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">raise_on_blocked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Use `response_validation` instead of `raise_on_blocked`.&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response_validation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Cannot use `response_validation` when `raise_on_blocked` is set.&quot;</span>
                <span class="p">)</span>
            <span class="n">response_validation</span> <span class="o">=</span> <span class="n">raise_on_blocked</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
            <span class="n">response_validation</span><span class="o">=</span><span class="n">response_validation</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_responder</span> <span class="o">=</span> <span class="n">responder</span>


<div class="viewcode-block" id="ResponseBlockedError"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.ResponseBlockedError">[docs]</a><span class="k">class</span> <span class="nc">ResponseBlockedError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">request_contents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">],</span>
        <span class="n">responses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;GenerationResponse&quot;</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request_contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span></div>


<div class="viewcode-block" id="ResponseValidationError"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.ResponseValidationError">[docs]</a><span class="k">class</span> <span class="nc">ResponseValidationError</span><span class="p">(</span><span class="n">ResponseBlockedError</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1">### Structures</span>


<div class="viewcode-block" id="GenerationConfig"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.GenerationConfig">[docs]</a><span class="k">class</span> <span class="nc">GenerationConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for the generation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">temperature</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_p</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">candidate_count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_output_tokens</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">stop_sequences</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">presence_penalty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">frequency_penalty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_mime_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Constructs a GenerationConfig object.</span>

<span class="sd">        Args:</span>
<span class="sd">            temperature: Controls the randomness of predictions. Range: [0.0, 1.0]</span>
<span class="sd">            top_p: If specified, nucleus sampling will be used. Range: (0.0, 1.0]</span>
<span class="sd">            top_k: If specified, top-k sampling will be used.</span>
<span class="sd">            candidate_count: Number of candidates to generate.</span>
<span class="sd">            max_output_tokens: The maximum number of output tokens to generate per message.</span>
<span class="sd">            stop_sequences: A list of stop sequences.</span>
<span class="sd">            presence_penalty: Positive values penalize tokens that have appeared in the generated text,</span>
<span class="sd">                thus increasing the possibility of generating more diversed topics. Range: [-2.0, 2.0]</span>
<span class="sd">            frequency_penalty: Positive values penalize tokens that repeatedly appear in the generated</span>
<span class="sd">                text, thus decreasing the possibility of repeating the same content. Range: [-2.0, 2.0]</span>
<span class="sd">            response_mime_type: Output response mimetype of the generated</span>
<span class="sd">                candidate text. Supported mimetypes:</span>

<span class="sd">                -  ``text/plain``: (default) Text output.</span>
<span class="sd">                -  ``application/json``: JSON response in the candidates.</span>

<span class="sd">                The model needs to be prompted to output the appropriate</span>
<span class="sd">                response type, otherwise the behavior is undefined.</span>

<span class="sd">        Usage:</span>
<span class="sd">            ```</span>
<span class="sd">            response = model.generate_content(</span>
<span class="sd">                &quot;Why is sky blue?&quot;,</span>
<span class="sd">                generation_config=GenerationConfig(</span>
<span class="sd">                    temperature=0.1,</span>
<span class="sd">                    top_p=0.95,</span>
<span class="sd">                    top_k=20,</span>
<span class="sd">                    candidate_count=1,</span>
<span class="sd">                    max_output_tokens=100,</span>
<span class="sd">                    stop_sequences=[&quot;\n\n\n&quot;],</span>
<span class="sd">                )</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_generation_config</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GenerationConfig</span><span class="p">(</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">top_p</span><span class="o">=</span><span class="n">top_p</span><span class="p">,</span>
            <span class="n">top_k</span><span class="o">=</span><span class="n">top_k</span><span class="p">,</span>
            <span class="n">candidate_count</span><span class="o">=</span><span class="n">candidate_count</span><span class="p">,</span>
            <span class="n">max_output_tokens</span><span class="o">=</span><span class="n">max_output_tokens</span><span class="p">,</span>
            <span class="n">stop_sequences</span><span class="o">=</span><span class="n">stop_sequences</span><span class="p">,</span>
            <span class="n">presence_penalty</span><span class="o">=</span><span class="n">presence_penalty</span><span class="p">,</span>
            <span class="n">frequency_penalty</span><span class="o">=</span><span class="n">frequency_penalty</span><span class="p">,</span>
            <span class="n">response_mime_type</span><span class="o">=</span><span class="n">response_mime_type</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">raw_generation_config</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GenerationConfig</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationConfig&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_raw_generation_config</span> <span class="o">=</span> <span class="n">raw_generation_config</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">generation_config_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationConfig&quot;</span><span class="p">:</span>
        <span class="n">raw_generation_config</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GenerationConfig</span><span class="p">(</span>
            <span class="n">generation_config_dict</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_generation_config</span><span class="o">=</span><span class="n">raw_generation_config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_generation_config</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_generation_config</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>


<div class="viewcode-block" id="Tool"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Tool">[docs]</a><span class="k">class</span> <span class="nc">Tool</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A collection of functions that the model may use to generate response.</span>

<span class="sd">    Usage:</span>
<span class="sd">        Create tool from function declarations:</span>
<span class="sd">        ```</span>
<span class="sd">        get_current_weather_func = generative_models.FunctionDeclaration(...)</span>
<span class="sd">        weather_tool = generative_models.Tool(</span>
<span class="sd">            function_declarations=[get_current_weather_func],</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        Use tool in `GenerativeModel.generate_content`:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(&quot;gemini-pro&quot;)</span>
<span class="sd">        print(model.generate_content(</span>
<span class="sd">            &quot;What is the weather like in Boston?&quot;,</span>
<span class="sd">            # You can specify tools when creating a model to avoid having to send them with every request.</span>
<span class="sd">            tools=[weather_tool],</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">        Use tool in chat:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(</span>
<span class="sd">            &quot;gemini-pro&quot;,</span>
<span class="sd">            # You can specify tools when creating a model to avoid having to send them with every request.</span>
<span class="sd">            tools=[weather_tool],</span>
<span class="sd">        )</span>
<span class="sd">        chat = model.start_chat()</span>
<span class="sd">        print(chat.send_message(&quot;What is the weather like in Boston?&quot;))</span>
<span class="sd">        print(chat.send_message(</span>
<span class="sd">            Part.from_function_response(</span>
<span class="sd">                name=&quot;get_current_weather&quot;,</span>
<span class="sd">                response={</span>
<span class="sd">                    &quot;content&quot;: {&quot;weather_there&quot;: &quot;super nice&quot;},</span>
<span class="sd">                }</span>
<span class="sd">            ),</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_raw_tool</span><span class="p">:</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">function_declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;FunctionDeclaration&quot;</span><span class="p">],</span>
    <span class="p">):</span>
        <span class="n">gapic_function_declarations</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">function_declaration</span><span class="o">.</span><span class="n">_raw_function_declaration</span>
            <span class="k">for</span> <span class="n">function_declaration</span> <span class="ow">in</span> <span class="n">function_declarations</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_tool</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span>
            <span class="n">function_declarations</span><span class="o">=</span><span class="n">gapic_function_declarations</span>
        <span class="p">)</span>
        <span class="n">callable_functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">function_declaration</span><span class="o">.</span><span class="n">_raw_function_declaration</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">function_declaration</span>
            <span class="k">for</span> <span class="n">function_declaration</span> <span class="ow">in</span> <span class="n">function_declarations</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function_declaration</span><span class="p">,</span> <span class="n">CallableFunctionDeclaration</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_functions</span> <span class="o">=</span> <span class="n">callable_functions</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_function_declarations</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">function_declarations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;FunctionDeclaration&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tool&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Tool</span><span class="p">(</span><span class="n">function_declarations</span><span class="o">=</span><span class="n">function_declarations</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_retrieval</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">retrieval</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;grounding.Retrieval&quot;</span><span class="p">,</span> <span class="s2">&quot;rag.Retrieval&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tool&quot;</span><span class="p">:</span>
        <span class="n">raw_tool</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span><span class="n">retrieval</span><span class="o">=</span><span class="n">retrieval</span><span class="o">.</span><span class="n">_raw_retrieval</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_tool</span><span class="o">=</span><span class="n">raw_tool</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_google_search_retrieval</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">google_search_retrieval</span><span class="p">:</span> <span class="s2">&quot;grounding.GoogleSearchRetrieval&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tool&quot;</span><span class="p">:</span>
        <span class="n">raw_tool</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span>
            <span class="n">google_search_retrieval</span><span class="o">=</span><span class="n">google_search_retrieval</span><span class="o">.</span><span class="n">_raw_google_search_retrieval</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_tool</span><span class="o">=</span><span class="n">raw_tool</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">raw_tool</span><span class="p">:</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tool&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">([])</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_raw_tool</span> <span class="o">=</span> <span class="n">raw_tool</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tool_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tool&quot;</span><span class="p">:</span>
        <span class="n">tool_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tool_dict</span><span class="p">)</span>
        <span class="n">function_declarations</span> <span class="o">=</span> <span class="n">tool_dict</span><span class="p">[</span><span class="s2">&quot;function_declarations&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">function_declaration</span> <span class="ow">in</span> <span class="n">function_declarations</span><span class="p">:</span>
            <span class="n">function_declaration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert_schema_dict_to_gapic</span><span class="p">(</span>
                <span class="n">function_declaration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">raw_tool</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Tool</span><span class="p">(</span><span class="n">tool_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_tool</span><span class="o">=</span><span class="n">raw_tool</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_tool</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_tool</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>


<div class="viewcode-block" id="ToolConfig"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.ToolConfig">[docs]</a><span class="k">class</span> <span class="nc">ToolConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Config shared for all tools provided in the request.</span>

<span class="sd">    Usage:</span>
<span class="sd">        Create ToolConfig</span>
<span class="sd">        ```</span>
<span class="sd">        tool_config = ToolConfig(</span>
<span class="sd">            function_calling_config=ToolConfig.FunctionCallingConfig(</span>
<span class="sd">                mode=ToolConfig.FunctionCallingConfig.Mode.ANY,</span>
<span class="sd">                allowed_function_names=[&quot;get_current_weather_func&quot;],</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">        Use ToolConfig in `GenerativeModel.generate_content`:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(&quot;gemini-pro&quot;)</span>
<span class="sd">        print(model.generate_content(</span>
<span class="sd">            &quot;What is the weather like in Boston?&quot;,</span>
<span class="sd">            # You can specify tools when creating a model to avoid having to send them with every request.</span>
<span class="sd">            tools=[weather_tool],</span>
<span class="sd">            tool_config=tool_config,</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">        Use ToolConfig in chat:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(</span>
<span class="sd">            &quot;gemini-pro&quot;,</span>
<span class="sd">            # You can specify tools when creating a model to avoid having to send them with every request.</span>
<span class="sd">            tools=[weather_tool],</span>
<span class="sd">            tool_config=tool_config,</span>
<span class="sd">        )</span>
<span class="sd">        chat = model.start_chat()</span>
<span class="sd">        print(chat.send_message(&quot;What is the weather like in Boston?&quot;))</span>
<span class="sd">        print(chat.send_message(</span>
<span class="sd">            Part.from_function_response(</span>
<span class="sd">                name=&quot;get_current_weather&quot;,</span>
<span class="sd">                response={</span>
<span class="sd">                    &quot;content&quot;: {&quot;weather_there&quot;: &quot;super nice&quot;},</span>
<span class="sd">                }</span>
<span class="sd">            ),</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">FunctionCallingConfig</span><span class="p">:</span>
        <span class="n">Mode</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionCallingConfig</span><span class="o">.</span><span class="n">Mode</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">mode</span><span class="p">:</span> <span class="s2">&quot;ToolConfig.FunctionCallingConfig.Mode&quot;</span><span class="p">,</span>
            <span class="n">allowed_function_names</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Constructs FunctionCallingConfig.</span>

<span class="sd">            Args:</span>
<span class="sd">                mode: Enum describing the function calling mode</span>
<span class="sd">                allowed_function_names: A list of allowed function names</span>
<span class="sd">                    (must match from Tool). Only set when the Mode is ANY.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_gapic_function_calling_config</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionCallingConfig</span><span class="p">(</span>
                    <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                    <span class="n">allowed_function_names</span><span class="o">=</span><span class="n">allowed_function_names</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_calling_config</span><span class="p">:</span> <span class="s2">&quot;ToolConfig.FunctionCallingConfig&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gapic_tool_config</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">ToolConfig</span><span class="p">(</span>
            <span class="n">function_calling_config</span><span class="o">=</span><span class="n">function_calling_config</span><span class="o">.</span><span class="n">_gapic_function_calling_config</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="FunctionDeclaration"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.FunctionDeclaration">[docs]</a><span class="k">class</span> <span class="nc">FunctionDeclaration</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A representation of a function declaration.</span>

<span class="sd">    Usage:</span>
<span class="sd">        Create function declaration and tool:</span>
<span class="sd">        ```</span>
<span class="sd">        get_current_weather_func = generative_models.FunctionDeclaration(</span>
<span class="sd">            name=&quot;get_current_weather&quot;,</span>
<span class="sd">            description=&quot;Get the current weather in a given location&quot;,</span>
<span class="sd">            parameters={</span>
<span class="sd">                &quot;type&quot;: &quot;object&quot;,</span>
<span class="sd">                &quot;properties&quot;: {</span>
<span class="sd">                    &quot;location&quot;: {</span>
<span class="sd">                        &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">                        &quot;description&quot;: &quot;The city and state, e.g. San Francisco, CA&quot;</span>
<span class="sd">                    },</span>
<span class="sd">                    &quot;unit&quot;: {</span>
<span class="sd">                        &quot;type&quot;: &quot;string&quot;,</span>
<span class="sd">                        &quot;enum&quot;: [</span>
<span class="sd">                            &quot;celsius&quot;,</span>
<span class="sd">                            &quot;fahrenheit&quot;,</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                },</span>
<span class="sd">                &quot;required&quot;: [</span>
<span class="sd">                    &quot;location&quot;</span>
<span class="sd">                ]</span>
<span class="sd">            },</span>
<span class="sd">        )</span>
<span class="sd">        weather_tool = generative_models.Tool(</span>
<span class="sd">            function_declarations=[get_current_weather_func],</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        Use tool in `GenerativeModel.generate_content`:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(&quot;gemini-pro&quot;)</span>
<span class="sd">        print(model.generate_content(</span>
<span class="sd">            &quot;What is the weather like in Boston?&quot;,</span>
<span class="sd">            # You can specify tools when creating a model to avoid having to send them with every request.</span>
<span class="sd">            tools=[weather_tool],</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">        Use tool in chat:</span>
<span class="sd">        ```</span>
<span class="sd">        model = GenerativeModel(</span>
<span class="sd">            &quot;gemini-pro&quot;,</span>
<span class="sd">            # You can specify tools when creating a model to avoid having to send them with every request.</span>
<span class="sd">            tools=[weather_tool],</span>
<span class="sd">        )</span>
<span class="sd">        chat = model.start_chat()</span>
<span class="sd">        print(chat.send_message(&quot;What is the weather like in Boston?&quot;))</span>
<span class="sd">        print(chat.send_message(</span>
<span class="sd">            Part.from_function_response(</span>
<span class="sd">                name=&quot;get_current_weather&quot;,</span>
<span class="sd">                response={</span>
<span class="sd">                    &quot;content&quot;: {&quot;weather_there&quot;: &quot;super nice&quot;},</span>
<span class="sd">                }</span>
<span class="sd">            ),</span>
<span class="sd">        ))</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs a FunctionDeclaration.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the function that the model can call.</span>
<span class="sd">            parameters: Describes the parameters to this function in JSON Schema Object format.</span>
<span class="sd">            description: Description and purpose of the function.</span>
<span class="sd">                Model uses it to decide how and whether to call the function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gapic_schema_dict</span> <span class="o">=</span> <span class="n">_convert_schema_dict_to_gapic</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">raw_schema</span> <span class="o">=</span> <span class="n">aiplatform_types</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">gapic_schema_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_function_declaration</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionDeclaration</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">raw_schema</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;CallableFunctionDeclaration&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CallableFunctionDeclaration</span><span class="o">.</span><span class="n">from_func</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_function_declaration</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_function_declaration</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>


<span class="k">def</span> <span class="nf">_convert_schema_dict_to_gapic</span><span class="p">(</span><span class="n">schema_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a JsonSchema to a dict that the GAPIC Schema class accepts.&quot;&quot;&quot;</span>
    <span class="n">gapic_schema_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">schema_dict</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">in</span> <span class="n">gapic_schema_dict</span><span class="p">:</span>
        <span class="n">gapic_schema_dict</span><span class="p">[</span><span class="s2">&quot;type_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gapic_schema_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;format&quot;</span> <span class="ow">in</span> <span class="n">gapic_schema_dict</span><span class="p">:</span>
        <span class="n">gapic_schema_dict</span><span class="p">[</span><span class="s2">&quot;format_&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gapic_schema_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;format&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;items&quot;</span> <span class="ow">in</span> <span class="n">gapic_schema_dict</span><span class="p">:</span>
        <span class="n">gapic_schema_dict</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert_schema_dict_to_gapic</span><span class="p">(</span>
            <span class="n">gapic_schema_dict</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="n">gapic_schema_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;properties&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">properties</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">property_name</span><span class="p">,</span> <span class="n">property_schema</span> <span class="ow">in</span> <span class="n">properties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">properties</span><span class="p">[</span><span class="n">property_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_convert_schema_dict_to_gapic</span><span class="p">(</span><span class="n">property_schema</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gapic_schema_dict</span>


<div class="viewcode-block" id="CallableFunctionDeclaration"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.CallableFunctionDeclaration">[docs]</a><span class="k">class</span> <span class="nc">CallableFunctionDeclaration</span><span class="p">(</span><span class="n">FunctionDeclaration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A function declaration plus a function.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">function</span>

<div class="viewcode-block" id="CallableFunctionDeclaration.from_func"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.CallableFunctionDeclaration.from_func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;CallableFunctionDeclaration&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically creates a CallableFunctionDeclaration from a Python function.</span>

<span class="sd">        The function parameter schema is automatically extracted.</span>
<span class="sd">        Args:</span>
<span class="sd">          func: The function from which to extract schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CallableFunctionDeclaration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">vertexai.generative_models</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">_function_calling_utils</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">function_schema</span> <span class="o">=</span> <span class="n">_function_calling_utils</span><span class="o">.</span><span class="n">generate_json_schema_from_function</span><span class="p">(</span>
            <span class="n">func</span>
        <span class="p">)</span>
        <span class="c1"># Getting out the description first since it will be removed from the schema.</span>
        <span class="n">function_description</span> <span class="o">=</span> <span class="n">function_schema</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
        <span class="n">function_schema</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">_function_calling_utils</span><span class="o">.</span><span class="n">adapt_json_schema_to_google_tool_schema</span><span class="p">(</span>
                <span class="n">function_schema</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">CallableFunctionDeclaration</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="n">function</span><span class="o">=</span><span class="n">func</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">function_description</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">function_schema</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="GenerationResponse"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.GenerationResponse">[docs]</a><span class="k">class</span> <span class="nc">GenerationResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The response from the model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw_response</span> <span class="o">=</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_response</span> <span class="o">=</span> <span class="n">raw_response</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">raw_response</span><span class="p">:</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_raw_response</span> <span class="o">=</span> <span class="n">raw_response</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">:</span>
        <span class="n">raw_response</span> <span class="o">=</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="p">()</span>
        <span class="n">json_format</span><span class="o">.</span><span class="n">ParseDict</span><span class="p">(</span><span class="n">response_dict</span><span class="p">,</span> <span class="n">raw_response</span><span class="o">.</span><span class="n">_pb</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_response</span><span class="o">=</span><span class="n">raw_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_response</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Candidate&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Candidate</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_candidate</span><span class="o">=</span><span class="n">raw_candidate</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">raw_candidate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_response</span><span class="o">.</span><span class="n">candidates</span>
        <span class="p">]</span>

    <span class="c1"># GenerationPart properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The response has multiple candidates.&quot;</span>
                <span class="s2">&quot; Use `response.candidate[i].text` to get text of a particular candidate.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Response has no candidates (and thus no text).&quot;</span>
                <span class="s2">&quot; The response is likely blocked by the safety filters.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Response:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">_dict_to_pretty_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Enrich the error message with the whole Response.</span>
            <span class="c1"># The Candidate object does not have full information.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot get the response text.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Response:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">_dict_to_pretty_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prompt_feedback</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="o">.</span><span class="n">PromptFeedback</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_response</span><span class="o">.</span><span class="n">prompt_feedback</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">usage_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="o">.</span><span class="n">UsageMetadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_response</span><span class="o">.</span><span class="n">usage_metadata</span></div>


<div class="viewcode-block" id="Candidate"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Candidate">[docs]</a><span class="k">class</span> <span class="nc">Candidate</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A response candidate generated by the model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw_candidate</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span> <span class="o">=</span> <span class="n">raw_candidate</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">raw_candidate</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Candidate&quot;</span><span class="p">:</span>
        <span class="n">candidate</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">candidate</span><span class="o">.</span><span class="n">_raw_candidate</span> <span class="o">=</span> <span class="n">raw_candidate</span>
        <span class="k">return</span> <span class="n">candidate</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">candidate_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Candidate&quot;</span><span class="p">:</span>
        <span class="n">raw_candidate</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="p">()</span>
        <span class="n">json_format</span><span class="o">.</span><span class="n">ParseDict</span><span class="p">(</span><span class="n">candidate_dict</span><span class="p">,</span> <span class="n">raw_candidate</span><span class="o">.</span><span class="n">_pb</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_candidate</span><span class="o">=</span><span class="n">raw_candidate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Content&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Content</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">raw_content</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">finish_reason</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="o">.</span><span class="n">FinishReason</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">finish_reason</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">finish_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">finish_message</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">index</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">safety_ratings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetyRating</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">safety_ratings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">citation_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">CitationMetadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">citation_metadata</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">grounding_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">GroundingMetadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_candidate</span><span class="o">.</span><span class="n">grounding_metadata</span>

    <span class="c1"># GenerationPart properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">text</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Enrich the error message with the whole Candidate.</span>
            <span class="c1"># The Content object does not have full information.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot get the Candidate text.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Candidate:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">_dict_to_pretty_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">function_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionCall</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">part</span><span class="o">.</span><span class="n">function_call</span>
            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span>
            <span class="k">if</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">part</span><span class="o">.</span><span class="n">function_call</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="Content"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Content">[docs]</a><span class="k">class</span> <span class="nc">Content</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The multi-part content of a message.</span>

<span class="sd">    Usage:</span>
<span class="sd">        ```</span>
<span class="sd">        response = model.generate_content(contents=[</span>
<span class="sd">            Content(role=&quot;user&quot;, parts=[Part.from_text(&quot;Why is sky blue?&quot;)])</span>
<span class="sd">        ])</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Part&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">role</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">raw_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">_raw_part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span> <span class="ow">or</span> <span class="p">[]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_content</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="n">raw_parts</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">raw_content</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Content&quot;</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">content</span><span class="o">.</span><span class="n">_raw_content</span> <span class="o">=</span> <span class="n">raw_content</span>
        <span class="k">return</span> <span class="n">content</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">content_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Content&quot;</span><span class="p">:</span>
        <span class="n">raw_content</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">()</span>
        <span class="n">json_format</span><span class="o">.</span><span class="n">ParseDict</span><span class="p">(</span><span class="n">content_dict</span><span class="p">,</span> <span class="n">raw_content</span><span class="o">.</span><span class="n">_pb</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_content</span><span class="o">=</span><span class="n">raw_content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_content</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_content</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Part&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Part</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_part</span><span class="o">=</span><span class="n">raw_part</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw_part</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_content</span><span class="o">.</span><span class="n">parts</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">role</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_content</span><span class="o">.</span><span class="n">role</span>

    <span class="nd">@role</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_content</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>

    <span class="c1"># GenerationPart properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Multiple content parts are not supported.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Response candidate content has no parts (and thus no text).&quot;</span>
                <span class="s2">&quot; The candidate is likely blocked by the safety filters.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Content:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">_dict_to_pretty_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span></div>


<div class="viewcode-block" id="Part"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Part">[docs]</a><span class="k">class</span> <span class="nc">Part</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A part of a multi-part Content message.</span>

<span class="sd">    Usage:</span>
<span class="sd">        ```</span>
<span class="sd">        text_part = Part.from_text(&quot;Why is sky blue?&quot;)</span>
<span class="sd">        image_part = Part.from_image(Image.load_from_file(&quot;image.jpg&quot;))</span>
<span class="sd">        video_part = Part.from_uri(uri=&quot;gs://.../video.mp4&quot;, mime_type=&quot;video/mp4&quot;)</span>
<span class="sd">        function_response_part = Part.from_function_response(</span>
<span class="sd">            name=&quot;get_current_weather&quot;,</span>
<span class="sd">            response={</span>
<span class="sd">                &quot;content&quot;: {&quot;weather_there&quot;: &quot;super nice&quot;},</span>
<span class="sd">            }</span>
<span class="sd">        )</span>

<span class="sd">        response1 = model.generate_content([text_part, image_part])</span>
<span class="sd">        response2 = model.generate_content(video_part)</span>
<span class="sd">        response3 = chat.send_message(function_response_part)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw_part</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span> <span class="o">=</span> <span class="n">raw_part</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">raw_part</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="n">part</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">part</span><span class="o">.</span><span class="n">_raw_part</span> <span class="o">=</span> <span class="n">raw_part</span>
        <span class="k">return</span> <span class="n">part</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">part_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="n">raw_part</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">()</span>
        <span class="n">json_format</span><span class="o">.</span><span class="n">ParseDict</span><span class="p">(</span><span class="n">part_dict</span><span class="p">,</span> <span class="n">raw_part</span><span class="o">.</span><span class="n">_pb</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_part</span><span class="o">=</span><span class="n">raw_part</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">mime_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Part</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">raw_part</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
                <span class="n">inline_data</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Blob</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="n">mime_type</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mime_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Part</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">raw_part</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
                <span class="n">file_data</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">FileData</span><span class="p">(</span>
                    <span class="n">file_uri</span><span class="o">=</span><span class="n">uri</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="n">mime_type</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Part</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_part</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="s2">&quot;Image&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Part</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">_mime_type</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_function_response</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Part&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Part</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span>
            <span class="n">raw_part</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
                <span class="n">function_response</span><span class="o">=</span><span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionResponse</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s2">&quot;Response candidate content part has no text.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Part:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="n">_dict_to_pretty_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">text</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mime_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">part_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">WhichOneof</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">part_type</span> <span class="o">==</span> <span class="s2">&quot;inline_data&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">inline_data</span><span class="o">.</span><span class="n">mime_type</span>
        <span class="k">if</span> <span class="n">part_type</span> <span class="o">==</span> <span class="s2">&quot;file_data&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">file_data</span><span class="o">.</span><span class="n">mime_type</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Part has no mime_type.</span><span class="se">\n</span><span class="s2">Part:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inline_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Blob</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">inline_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">FileData</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">file_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">function_call</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionCall</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">function_call</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">function_response</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">FunctionResponse</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">function_response</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_part</span><span class="o">.</span><span class="n">inline_data</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="SafetySetting"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.SafetySetting">[docs]</a><span class="k">class</span> <span class="nc">SafetySetting</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for the generation.&quot;&quot;&quot;</span>

    <span class="n">HarmCategory</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">HarmCategory</span>
    <span class="n">HarmBlockMethod</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="o">.</span><span class="n">HarmBlockMethod</span>
    <span class="n">HarmBlockThreshold</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="o">.</span><span class="n">HarmBlockThreshold</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">category</span><span class="p">:</span> <span class="s2">&quot;SafetySetting.HarmCategory&quot;</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="s2">&quot;SafetySetting.HarmBlockThreshold&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;SafetySetting.HarmBlockMethod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Safety settings.</span>

<span class="sd">        Args:</span>
<span class="sd">            category: Harm category.</span>
<span class="sd">            threshold: The harm block threshold.</span>
<span class="sd">            method: Specify if the threshold is used for probability or severity</span>
<span class="sd">                score. If not specified, the threshold is used for probability</span>
<span class="sd">                score.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_safety_setting</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="p">(</span>
            <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_gapic</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">raw_safety_setting</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SafetySetting&quot;</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">category</span><span class="o">=</span><span class="n">raw_safety_setting</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">raw_safety_setting</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">_raw_safety_setting</span> <span class="o">=</span> <span class="n">raw_safety_setting</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">safety_setting_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;SafetySetting&quot;</span><span class="p">:</span>
        <span class="n">raw_safety_setting</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">SafetySetting</span><span class="p">(</span><span class="n">safety_setting_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_gapic</span><span class="p">(</span><span class="n">raw_safety_setting</span><span class="o">=</span><span class="n">raw_safety_setting</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">_proto_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_safety_setting</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_safety_setting</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span></div>


<div class="viewcode-block" id="grounding"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.grounding">[docs]</a><span class="k">class</span> <span class="nc">grounding</span><span class="p">:</span>  <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Grounding namespace.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;This class must not be instantiated.&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="grounding.Retrieval"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.grounding.Retrieval">[docs]</a>    <span class="k">class</span> <span class="nc">Retrieval</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines a retrieval tool that model can call to access external knowledge.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">source</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;grounding.VertexAISearch&quot;</span><span class="p">],</span>
            <span class="n">disable_attribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Initializes a Retrieval tool.</span>

<span class="sd">            Args:</span>
<span class="sd">                source (VertexAISearch):</span>
<span class="sd">                    Set to use data source powered by Vertex AI Search.</span>
<span class="sd">                disable_attribution (bool):</span>
<span class="sd">                    Optional. Disable using the result from this</span>
<span class="sd">                    tool in detecting grounding attribution. This</span>
<span class="sd">                    does not affect how the result is given to the</span>
<span class="sd">                    model for generation.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_retrieval</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">Retrieval</span><span class="p">(</span>
                <span class="n">vertex_ai_search</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">_raw_vertex_ai_search</span><span class="p">,</span>
                <span class="n">disable_attribution</span><span class="o">=</span><span class="n">disable_attribution</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="grounding.VertexAISearch"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.grounding.VertexAISearch">[docs]</a>    <span class="k">class</span> <span class="nc">VertexAISearch</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Retrieve from Vertex AI Search datastore for grounding.</span>
<span class="sd">        See https://cloud.google.com/vertex-ai-search-and-conversation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">datastore</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Initializes a Vertex AI Search tool.</span>

<span class="sd">            Args:</span>
<span class="sd">                datastore (str):</span>
<span class="sd">                    Required. Fully-qualified Vertex AI Search&#39;s</span>
<span class="sd">                    datastore resource ID.</span>
<span class="sd">                    projects/&lt;&gt;/locations/&lt;&gt;/collections/&lt;&gt;/dataStores/&lt;&gt;</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_vertex_ai_search</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">VertexAISearch</span><span class="p">(</span>
                <span class="n">datastore</span><span class="o">=</span><span class="n">datastore</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="grounding.GoogleSearchRetrieval"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.grounding.GoogleSearchRetrieval">[docs]</a>    <span class="k">class</span> <span class="nc">GoogleSearchRetrieval</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Tool to retrieve public web data for grounding, powered by</span>
<span class="sd">        Google Search.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            disable_attribution (bool):</span>
<span class="sd">                Optional. Disable using the result from this</span>
<span class="sd">                tool in detecting grounding attribution. This</span>
<span class="sd">                does not affect how the result is given to the</span>
<span class="sd">                model for generation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">disable_attribution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Initializes a Google Search Retrieval tool.</span>

<span class="sd">            Args:</span>
<span class="sd">                disable_attribution (bool):</span>
<span class="sd">                    Optional. Disable using the result from this</span>
<span class="sd">                    tool in detecting grounding attribution. This</span>
<span class="sd">                    does not affect how the result is given to the</span>
<span class="sd">                    model for generation.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_google_search_retrieval</span> <span class="o">=</span> <span class="n">gapic_tool_types</span><span class="o">.</span><span class="n">GoogleSearchRetrieval</span><span class="p">(</span>
                <span class="n">disable_attribution</span><span class="o">=</span><span class="n">disable_attribution</span><span class="p">,</span>
            <span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_to_content</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">,</span>
        <span class="n">Content</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;Image&quot;</span><span class="p">,</span>
        <span class="n">Part</span><span class="p">,</span>
        <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">,</span>
        <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">]],</span>
    <span class="p">],</span>
    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_GenerativeModel</span><span class="o">.</span><span class="n">_USER_ROLE</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts different kinds of values to gapic_content_types.Content object.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;value must not be empty&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Content</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">_raw_content</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Image</span><span class="p">,</span> <span class="n">Part</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">)):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected value type: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">parts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Part</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">_raw_part</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Image</span><span class="p">):</span>
            <span class="n">part</span> <span class="o">=</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
                <span class="n">inline_data</span><span class="o">=</span><span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Blob</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mime_type</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">_mime_type</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A list of Content objects is not supported here: </span><span class="si">{</span><span class="n">items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unexpected item type: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="s2">&quot;Only types that represent a single Content or a single Part are supported here.&quot;</span>
            <span class="p">)</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="n">parts</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">role</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_append_response</span><span class="p">(</span>
    <span class="n">base_response</span><span class="p">:</span> <span class="n">GenerationResponse</span><span class="p">,</span>
    <span class="n">new_response</span><span class="p">:</span> <span class="n">GenerationResponse</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">_append_gapic_response</span><span class="p">(</span>
        <span class="n">base_response</span><span class="o">=</span><span class="n">base_response</span><span class="o">.</span><span class="n">_raw_response</span><span class="p">,</span>
        <span class="n">new_response</span><span class="o">=</span><span class="n">new_response</span><span class="o">.</span><span class="n">_raw_response</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_append_gapic_response</span><span class="p">(</span>
    <span class="n">base_response</span><span class="p">:</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="p">,</span>
    <span class="n">new_response</span><span class="p">:</span> <span class="n">gapic_prediction_service_types</span><span class="o">.</span><span class="n">GenerateContentResponse</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">candidate</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">idx</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Incorrect new candidate ordering: </span><span class="si">{</span><span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">idx</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Incorrect base candidate ordering: </span><span class="si">{</span><span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">_append_gapic_candidate</span><span class="p">(</span><span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">candidate</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Incorrect base candidate ordering: </span><span class="si">{</span><span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">base_response</span><span class="o">.</span><span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
    <span class="c1"># prompt_feedback is always taken from the base_response</span>
    <span class="c1"># usage_metadata is always taken from the new_response</span>
    <span class="k">if</span> <span class="n">new_response</span><span class="o">.</span><span class="n">usage_metadata</span><span class="p">:</span>
        <span class="n">base_response</span><span class="o">.</span><span class="n">usage_metadata</span> <span class="o">=</span> <span class="n">new_response</span><span class="o">.</span><span class="n">usage_metadata</span>


<span class="k">def</span> <span class="nf">_append_gapic_candidate</span><span class="p">(</span>
    <span class="n">base_candidate</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="p">,</span>
    <span class="n">new_candidate</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Candidate</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">base_candidate</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Incorrect candidate indexes: </span><span class="si">{</span><span class="n">base_candidate</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">new_candidate</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Only merge content if it exists.</span>
    <span class="k">if</span> <span class="s2">&quot;content&quot;</span> <span class="ow">in</span> <span class="n">new_candidate</span><span class="p">:</span>
        <span class="n">_append_gapic_content</span><span class="p">(</span><span class="n">base_candidate</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="c1"># For these attributes, the last value wins</span>
    <span class="k">if</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">finish_reason</span><span class="p">:</span>
        <span class="n">base_candidate</span><span class="o">.</span><span class="n">finish_reason</span> <span class="o">=</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">finish_reason</span>
    <span class="k">if</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">safety_ratings</span><span class="p">:</span>
        <span class="n">base_candidate</span><span class="o">.</span><span class="n">safety_ratings</span> <span class="o">=</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">safety_ratings</span>
    <span class="k">if</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">finish_message</span><span class="p">:</span>
        <span class="n">base_candidate</span><span class="o">.</span><span class="n">finish_message</span> <span class="o">=</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">finish_message</span>
    <span class="k">if</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">citation_metadata</span><span class="p">:</span>
        <span class="n">base_candidate</span><span class="o">.</span><span class="n">citation_metadata</span> <span class="o">=</span> <span class="n">new_candidate</span><span class="o">.</span><span class="n">citation_metadata</span>


<span class="k">def</span> <span class="nf">_append_gapic_content</span><span class="p">(</span>
    <span class="n">base_content</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">,</span>
    <span class="n">new_content</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Content</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># Handling empty role is a workaround for a case when service returns</span>
    <span class="c1"># some chunks with missing role field (e.g. when response is blocked).</span>
    <span class="k">if</span> <span class="n">new_content</span><span class="o">.</span><span class="n">role</span> <span class="ow">and</span> <span class="n">base_content</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="n">new_content</span><span class="o">.</span><span class="n">role</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Content roles do not match: </span><span class="si">{</span><span class="n">base_content</span><span class="o">.</span><span class="n">role</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">new_content</span><span class="o">.</span><span class="n">role</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">part_idx</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_content</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">part_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">base_content</span><span class="o">.</span><span class="n">parts</span><span class="p">):</span>
            <span class="n">_append_gapic_part</span><span class="p">(</span><span class="n">base_content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="n">part_idx</span><span class="p">],</span> <span class="n">part</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_content</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_append_gapic_part</span><span class="p">(</span>
    <span class="n">base_part</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">,</span>
    <span class="n">new_part</span><span class="p">:</span> <span class="n">gapic_content_types</span><span class="o">.</span><span class="n">Part</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># Text is appended. For other cases, new wins.</span>
    <span class="k">if</span> <span class="n">new_part</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">base_part</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="n">new_part</span><span class="o">.</span><span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_part</span><span class="o">.</span><span class="n">_pb</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">new_part</span><span class="o">.</span><span class="n">_pb</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_proto_to_dict</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a proto-plus protobuf message to a dictionary.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span>
        <span class="n">message</span><span class="p">,</span>
        <span class="n">including_default_value_fields</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">use_integers_for_enums</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_dict_to_pretty_string</span><span class="p">(</span><span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format dict as a pretty-printed JSON string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="n">_FORMAT_TO_MIME_TYPE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;png&quot;</span><span class="p">:</span> <span class="s2">&quot;image/png&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jpeg&quot;</span><span class="p">:</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gif&quot;</span><span class="p">:</span> <span class="s2">&quot;image/gif&quot;</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The image that can be sent to a generative model.&quot;&quot;&quot;</span>

    <span class="n">_image_bytes</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">_loaded_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;PIL_Image.Image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Image.load_from_file"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Image.load_from_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads image from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path from where to load the image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Loaded image as an `Image` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">()</span>
        <span class="n">image</span><span class="o">.</span><span class="n">_image_bytes</span> <span class="o">=</span> <span class="n">image_bytes</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="Image.from_bytes"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.Image.from_bytes">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads image from image bytes.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: Image bytes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Loaded image as an `Image` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">()</span>
        <span class="n">image</span><span class="o">.</span><span class="n">_image_bytes</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">image</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_pil_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PIL_Image.Image&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">PIL_Image</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;The PIL module is not available. Please install the Pillow package.&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_image</span> <span class="o">=</span> <span class="n">PIL_Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_bytes</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_image</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mime_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the MIME type of the image.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">PIL_Image</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_FORMAT_TO_MIME_TYPE</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pil_image</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fall back to jpeg</span>
            <span class="k">return</span> <span class="s2">&quot;image/jpeg&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the image data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_image_bytes</span>

    <span class="k">def</span> <span class="nf">_repr_png_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pil_image</span><span class="o">.</span><span class="n">_repr_png_</span><span class="p">()</span></div>


<div class="viewcode-block" id="AutomaticFunctionCallingResponder"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.generative_models.AutomaticFunctionCallingResponder">[docs]</a><span class="k">class</span> <span class="nc">AutomaticFunctionCallingResponder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Responder that automatically responds to model&#39;s function calls.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_automatic_function_calls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the responder.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_automatic_function_calls: Maximum number of automatic function calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_automatic_function_calls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_automatic_function_calls must be positive.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_automatic_function_calls</span> <span class="o">=</span> <span class="n">max_automatic_function_calls</span>

    <span class="k">def</span> <span class="nf">_create_responder_for_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;_MessageResponder&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AutomaticFunctionCallingResponder</span><span class="o">.</span><span class="n">_MessageResponder</span><span class="p">(</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">max_automatic_function_calls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_automatic_function_calls</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">class</span> <span class="nc">_MessageResponder</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatic Function Calling responder for a single user message.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">],</span>
            <span class="n">max_automatic_function_calls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="o">**</span><span class="n">_</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="n">tools</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_automatic_function_calls</span> <span class="o">=</span> <span class="n">max_automatic_function_calls</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_function_calls</span> <span class="o">=</span> <span class="n">max_automatic_function_calls</span>

        <span class="k">def</span> <span class="nf">respond_to_model_response</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="n">response</span><span class="p">:</span> <span class="s2">&quot;GenerationResponse&quot;</span><span class="p">,</span>
            <span class="o">**</span><span class="n">_</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Responds to model&#39;s response.</span>

<span class="sd">            Args:</span>
<span class="sd">                response: Model&#39;s response that can be auto-responded.</span>

<span class="sd">            Returns:</span>
<span class="sd">                Optional response to model&#39;s response.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">chosen_candidate</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">function_calls</span> <span class="o">=</span> <span class="n">chosen_candidate</span><span class="o">.</span><span class="n">function_calls</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">function_calls</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">_tools</span>
            <span class="n">function_response_parts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">function_call</span> <span class="ow">in</span> <span class="n">function_calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_function_calls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_remaining_function_calls</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Exceeded the maximum number of automatic function calls (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_automatic_function_calls</span><span class="si">}</span><span class="s2">).&quot;</span>
                        <span class="s2">&quot; If more automatic function calls are needed, set `max_automatic_function_calls` to a higher number.&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; The last function calls: </span><span class="si">{</span><span class="n">function_calls</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="n">callable_function</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
                    <span class="n">callable_function</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">_callable_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">function_call</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable_function</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Model has asked to call function &quot;</span><span class="si">{</span><span class="n">function_call</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot; which was not found.&quot;&quot;&quot;</span>
                    <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># We cannot use `function_args = type(function_call.args).to_dict(function_call.args)`</span>
                    <span class="c1"># due to: AttributeError: type object &#39;MapComposite&#39; has no attribute &#39;to_dict&#39;</span>
                    <span class="n">function_args</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">function_call</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">function_call</span><span class="p">)[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span>
                    <span class="n">function_call_result</span> <span class="o">=</span> <span class="n">callable_function</span><span class="o">.</span><span class="n">_function</span><span class="p">(</span><span class="o">**</span><span class="n">function_args</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Error raised when calling function &quot;</span><span class="si">{</span><span class="n">function_call</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot; as requested by the model.&quot;&quot;&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">ex</span>
                <span class="n">function_response_part</span> <span class="o">=</span> <span class="n">Part</span><span class="o">.</span><span class="n">from_function_response</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">function_call</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">response</span><span class="o">=</span><span class="n">function_call_result</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">function_response_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">function_response_part</span><span class="p">)</span>
            <span class="n">function_response_content</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span>
                <span class="n">parts</span><span class="o">=</span><span class="n">function_response_parts</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">function_response_content</span></div>


<span class="k">class</span> <span class="nc">GenerativeModel</span><span class="p">(</span><span class="n">_GenerativeModel</span><span class="p">):</span>
    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.generative_models&quot;</span>


<span class="k">class</span> <span class="nc">_PreviewGenerativeModel</span><span class="p">(</span><span class="n">_GenerativeModel</span><span class="p">):</span>
    <span class="vm">__name__</span> <span class="o">=</span> <span class="s2">&quot;GenerativeModel&quot;</span>
    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.preview.generative_models&quot;</span>

    <span class="k">def</span> <span class="nf">start_chat</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">history</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Content&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">response_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1"># Preview features:</span>
        <span class="n">responder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;AutomaticFunctionCallingResponder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ChatSession&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a stateful chat session.</span>

<span class="sd">        Args:</span>
<span class="sd">            history: Previous history to initialize the chat session.</span>
<span class="sd">            response_validation: Whether to validate responses before adding</span>
<span class="sd">                them to chat history. By default, `send_message` will raise</span>
<span class="sd">                error if the request or response is blocked or if the response</span>
<span class="sd">                is incomplete due to going over the max token limit.</span>
<span class="sd">                If set to `False`, the chat session history will always</span>
<span class="sd">                accumulate the request and response messages even if the</span>
<span class="sd">                response if blocked or incomplete. This can result in an unusable</span>
<span class="sd">                chat session state.</span>
<span class="sd">            responder: An responder object that can automatically respond to</span>
<span class="sd">                some model messages. Supported responder classes:</span>
<span class="sd">                `AutomaticFunctionCallingResponder`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A ChatSession object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_PreviewChatSession</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
            <span class="n">response_validation</span><span class="o">=</span><span class="n">response_validation</span><span class="p">,</span>
            <span class="n">responder</span><span class="o">=</span><span class="n">responder</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">google-cloud-aiplatform</a></h1>



<p class="blurb">Google Cloud Client Libraries for google-cloud-aiplatform</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=googleapis&repo=python-aiplatform&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../vertexai/services.html">Vertex AI SDK</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../generative_models.html">vertexai.generative_models</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, Google.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    
    <a href="https://github.com/googleapis/python-aiplatform" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>