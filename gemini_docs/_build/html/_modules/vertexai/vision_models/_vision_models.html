

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vertexai.vision_models._vision_models &#8212; google-cloud-aiplatform  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
          	<div class="admonition" id="python2-eol"> 
          	 As of January 1, 2020 this library no longer supports Python 2 on the latest released version. 
          	 Library versions released prior to that date will continue to be available. For more information please
          	 visit <a href="https://cloud.google.com/python/docs/python2-sunset/">Python 2 support on Google Cloud</a>.
          	</div>
            
  <h1>Source code for vertexai.vision_models._vision_models</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2023 Google LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot;Classes for working with vision models.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">storage</span>

<span class="kn">from</span> <span class="nn">google.cloud.aiplatform</span> <span class="kn">import</span> <span class="n">initializer</span> <span class="k">as</span> <span class="n">aiplatform_initializer</span>
<span class="kn">from</span> <span class="nn">vertexai._model_garden</span> <span class="kn">import</span> <span class="n">_model_garden_models</span>

<span class="c1"># pylint: disable=g-import-not-at-top</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">display</span> <span class="k">as</span> <span class="n">IPython_display</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">IPython_display</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">PIL_Image</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PIL_Image</span> <span class="o">=</span> <span class="kc">None</span>


<span class="n">_SUPPORTED_UPSCALING_SIZES</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Image.&quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">_loaded_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_loaded_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;PIL_Image.Image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an `Image` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_bytes: Image file bytes. Image can be in PNG or JPEG format.</span>
<span class="sd">            gcs_uri: Image URI in Google Cloud Storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">image_bytes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">(</span><span class="n">gcs_uri</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either image_bytes or gcs_uri must be provided.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_image_bytes</span> <span class="o">=</span> <span class="n">image_bytes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gcs_uri</span> <span class="o">=</span> <span class="n">gcs_uri</span>

<div class="viewcode-block" id="Image.load_from_file"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.Image.load_from_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads image from local file or Google Cloud Storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path or Google Cloud Storage uri from where to load</span>
<span class="sd">                the image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Loaded image as an `Image` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;https&quot;</span>
            <span class="ow">and</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span> <span class="o">==</span> <span class="s2">&quot;storage.googleapis.com&quot;</span>
        <span class="p">):</span>
            <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;gs&quot;</span><span class="p">,</span> <span class="n">netloc</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlunparse</span><span class="p">(</span><span class="n">parsed_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;gs&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Image</span><span class="p">(</span><span class="n">gcs_uri</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>

        <span class="c1"># Load image from local path</span>
        <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">image_bytes</span><span class="o">=</span><span class="n">image_bytes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_image_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">storage_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
                <span class="n">credentials</span><span class="o">=</span><span class="n">aiplatform_initializer</span><span class="o">.</span><span class="n">global_config</span><span class="o">.</span><span class="n">credentials</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Blob</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
                <span class="n">uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">storage_client</span>
            <span class="p">)</span><span class="o">.</span><span class="n">download_as_bytes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span>

    <span class="nd">@_image_bytes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_image_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_pil_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;PIL_Image.Image&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_image</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_image</span> <span class="o">=</span> <span class="n">PIL_Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_bytes</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_image</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pil_image</span><span class="o">.</span><span class="n">size</span>

<div class="viewcode-block" id="Image.show"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.Image.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shows the image.</span>

<span class="sd">        This method only works when in a notebook environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">PIL_Image</span> <span class="ow">and</span> <span class="n">IPython_display</span><span class="p">:</span>
            <span class="n">IPython_display</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pil_image</span><span class="p">)</span></div>

<div class="viewcode-block" id="Image.save"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.Image.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves image to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path where to save the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_bytes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_as_base64_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encodes image using the base64 encoding.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Base64 encoding of the image as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ! b64encode returns `bytes` object, not ``str.</span>
        <span class="c1"># We need to convert `bytes` to `str`, otherwise we get service error:</span>
        <span class="c1"># &quot;received initial metadata size exceeds limit&quot;</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_image_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Video</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Video.&quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">_loaded_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">video_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an `Image` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            video_bytes: Video file bytes. Video can be in AVI, FLV, MKV, MOV,</span>
<span class="sd">                MP4, MPEG, MPG, WEBM, and WMV formats.</span>
<span class="sd">            gcs_uri: Image URI in Google Cloud Storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">video_bytes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">(</span><span class="n">gcs_uri</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either video_bytes or gcs_uri must be provided.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_video_bytes</span> <span class="o">=</span> <span class="n">video_bytes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gcs_uri</span> <span class="o">=</span> <span class="n">gcs_uri</span>

<div class="viewcode-block" id="Video.load_from_file"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.Video.load_from_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Video&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads video from local file or Google Cloud Storage.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path or Google Cloud Storage uri from where to load</span>
<span class="sd">                the video.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Loaded video as an `Video` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;gs://&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Video</span><span class="p">(</span><span class="n">gcs_uri</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>

        <span class="n">video_bytes</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">()</span>
        <span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">(</span><span class="n">video_bytes</span><span class="o">=</span><span class="n">video_bytes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">video</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_video_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">storage_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
                <span class="n">credentials</span><span class="o">=</span><span class="n">aiplatform_initializer</span><span class="o">.</span><span class="n">global_config</span><span class="o">.</span><span class="n">credentials</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Blob</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
                <span class="n">uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">storage_client</span>
            <span class="p">)</span><span class="o">.</span><span class="n">download_as_bytes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span>

    <span class="nd">@_video_bytes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_video_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_bytes</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="Video.save"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.Video.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves video to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path where to save the video.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_video_bytes</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_as_base64_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Encodes video using the base64 encoding.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Base64 encoding of the video as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ! b64encode returns `bytes` object, not ``str.</span>
        <span class="c1"># We need to convert `bytes` to `str`, otherwise we get service error:</span>
        <span class="c1"># &quot;received initial metadata size exceeds limit&quot;</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_video_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">VideoSegmentConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The specific video segments (in seconds) the embeddings are generated for.&quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">start_offset_sec</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_offset_sec</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">interval_sec</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start_offset_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">end_offset_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>
        <span class="n">interval_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `VideoSegmentConfig` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            start_offset_sec: Start time offset (in seconds) to generate embeddings for.</span>
<span class="sd">            end_offset_sec: End time offset (in seconds) to generate embeddings for.</span>
<span class="sd">            interval_sec: Interval to divide video for generated embeddings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_offset_sec</span> <span class="o">=</span> <span class="n">start_offset_sec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_offset_sec</span> <span class="o">=</span> <span class="n">end_offset_sec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval_sec</span> <span class="o">=</span> <span class="n">interval_sec</span>


<span class="k">class</span> <span class="nc">VideoEmbedding</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Embeddings generated from video with offset times.&quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">start_offset_sec</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">end_offset_sec</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">embedding</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start_offset_sec</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_offset_sec</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">embedding</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `VideoEmbedding` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            start_offset_sec: Start time offset (in seconds) of generated embeddings.</span>
<span class="sd">            end_offset_sec: End time offset (in seconds) of generated embeddings.</span>
<span class="sd">            embedding: Generated embedding for interval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_offset_sec</span> <span class="o">=</span> <span class="n">start_offset_sec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_offset_sec</span> <span class="o">=</span> <span class="n">end_offset_sec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">embedding</span>


<span class="k">class</span> <span class="nc">ImageGenerationModel</span><span class="p">(</span>
    <span class="n">_model_garden_models</span><span class="o">.</span><span class="n">_ModelGardenModel</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates images from text prompt.</span>

<span class="sd">    Examples::</span>

<span class="sd">        model = ImageGenerationModel.from_pretrained(&quot;imagegeneration@002&quot;)</span>
<span class="sd">        response = model.generate_images(</span>
<span class="sd">            prompt=&quot;Astronaut riding a horse&quot;,</span>
<span class="sd">            # Optional:</span>
<span class="sd">            number_of_images=1,</span>
<span class="sd">            seed=0,</span>
<span class="sd">        )</span>
<span class="sd">        response[0].show()</span>
<span class="sd">        response[0].save(&quot;image1.png&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.preview.vision_models&quot;</span>

    <span class="n">_INSTANCE_SCHEMA_URI</span> <span class="o">=</span> <span class="s2">&quot;gs://google-cloud-aiplatform/schema/predict/instance/vision_generative_model_1.0.0.yaml&quot;</span>

    <span class="k">def</span> <span class="nf">_generate_images</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">negative_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">number_of_images</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aspect_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;1:1&quot;</span><span class="p">,</span> <span class="s2">&quot;9:16&quot;</span><span class="p">,</span> <span class="s2">&quot;16:9&quot;</span><span class="p">,</span> <span class="s2">&quot;4:3&quot;</span><span class="p">,</span> <span class="s2">&quot;3:4&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">guidance_scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">base_image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">edit_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span>
                <span class="s2">&quot;inpainting-insert&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inpainting-remove&quot;</span><span class="p">,</span>
                <span class="s2">&quot;outpainting&quot;</span><span class="p">,</span>
                <span class="s2">&quot;product-image&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;foreground&quot;</span><span class="p">,</span> <span class="s2">&quot;semantic&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">segmentation_classes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_dilation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">product_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;reposition&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_mime_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compression_quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">add_watermark</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_filter_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;block_most&quot;</span><span class="p">,</span> <span class="s2">&quot;block_some&quot;</span><span class="p">,</span> <span class="s2">&quot;block_few&quot;</span><span class="p">,</span> <span class="s2">&quot;block_fewest&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">person_generation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dont_allow&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_adult&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_all&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageGenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates images from text prompt.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt: Text prompt for the image.</span>
<span class="sd">            negative_prompt: A description of what you want to omit in the generated</span>
<span class="sd">              images.</span>
<span class="sd">            number_of_images: Number of images to generate. Range: 1..8.</span>
<span class="sd">            width: Width of the image. One of the sizes must be 256 or 1024.</span>
<span class="sd">            height: Height of the image. One of the sizes must be 256 or 1024.</span>
<span class="sd">            aspect_ratio: Aspect ratio for the image. Supported values are:</span>
<span class="sd">                * 1:1 - Square image</span>
<span class="sd">                * 9:16 - Portait image</span>
<span class="sd">                * 16:9 - Landscape image</span>
<span class="sd">                * 4:3 - Landscape, desktop ratio.</span>
<span class="sd">                * 3:4 - Portrait, desktop ratio</span>
<span class="sd">            guidance_scale: Controls the strength of the prompt. Suggested values</span>
<span class="sd">              are - * 0-9 (low strength) * 10-20 (medium strength) * 21+ (high</span>
<span class="sd">              strength)</span>
<span class="sd">            seed: Image generation random seed.</span>
<span class="sd">            base_image: Base image to use for the image generation.</span>
<span class="sd">            mask: Mask for the base image.</span>
<span class="sd">            edit_mode: Describes the editing mode for the request. Supported values</span>
<span class="sd">              are - * inpainting-insert: fills the mask area based on the text</span>
<span class="sd">              prompt (requires mask and text) * inpainting-remove: removes the</span>
<span class="sd">              object(s) in the mask area. (requires mask)</span>
<span class="sd">                * outpainting: extend the image based on the mask area. (Requires</span>
<span class="sd">                  mask) * product-image: Changes the background for the predominant</span>
<span class="sd">                  product or subject in the image</span>
<span class="sd">            mask_mode: Solicits generation of the mask (v/s providing mask as an</span>
<span class="sd">              input). Supported values are:</span>
<span class="sd">                * background: Automatically generates a mask for all regions except</span>
<span class="sd">                  the primary subject(s) of the image</span>
<span class="sd">                * foreground: Automatically generates a mask for the primary</span>
<span class="sd">                  subjects(s) of the image.</span>
<span class="sd">                * semantic: Segment one or more of the segmentation classes using</span>
<span class="sd">                  class ID</span>
<span class="sd">            segmentation_classes: List of class IDs for segmentation. Max of 5 IDs</span>
<span class="sd">            mask_dilation: Defines the dilation percentage of the mask provided.</span>
<span class="sd">              Float between 0 and 1. Defaults to 0.03</span>
<span class="sd">            product_position: Defines whether the product should stay fixed or be</span>
<span class="sd">              repositioned. Supported Values:</span>
<span class="sd">                * fixed: Fixed position</span>
<span class="sd">                * reposition: Can be moved (default)</span>
<span class="sd">            output_mime_type: Which image format should the output be saved as.</span>
<span class="sd">              Supported values: * image/png: Save as a PNG image * image/jpeg: Save</span>
<span class="sd">              as a JPEG image</span>
<span class="sd">            compression_quality: Level of compression if the output mime type is</span>
<span class="sd">              selected to be image/jpeg. Float between 0 to 100</span>
<span class="sd">            language: Language of the text prompt for the image. Default: None.</span>
<span class="sd">              Supported values are `&quot;en&quot;` for English, `&quot;hi&quot;` for Hindi, `&quot;ja&quot;` for</span>
<span class="sd">              Japanese, `&quot;ko&quot;` for Korean, and `&quot;auto&quot;` for automatic language</span>
<span class="sd">              detection.</span>
<span class="sd">            output_gcs_uri: Google Cloud Storage uri to store the generated images.</span>
<span class="sd">            add_watermark: Add a watermark to the generated image</span>
<span class="sd">            safety_filter_level: Adds a filter level to Safety filtering. Supported</span>
<span class="sd">              values are: * &quot;block_most&quot; : Strongest filtering level, most strict</span>
<span class="sd">              blocking * &quot;block_some&quot; : Block some problematic prompts and responses</span>
<span class="sd">              * &quot;block_few&quot; : Block fewer problematic prompts and responses *</span>
<span class="sd">              &quot;block_fewest&quot; : Block very few problematic prompts and responses</span>
<span class="sd">            person_generation: Allow generation of people by the model Supported</span>
<span class="sd">              values are: * &quot;dont_allow&quot; : Block generation of people *</span>
<span class="sd">              &quot;allow_adult&quot; : Generate adults, but not children * &quot;allow_all&quot; :</span>
<span class="sd">              Generate adults and children</span>

<span class="sd">        Returns:</span>
<span class="sd">            An `ImageGenerationResponse` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: Only a single prompt is supported by the service.</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}</span>
        <span class="n">shared_generation_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
            <span class="c1"># b/295946075 The service stopped supporting image sizes.</span>
            <span class="c1"># &quot;width&quot;: width,</span>
            <span class="c1"># &quot;height&quot;: height,</span>
            <span class="s2">&quot;number_of_images_in_batch&quot;</span><span class="p">:</span> <span class="n">number_of_images</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">base_image</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">base_image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">base_image</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">}</span>
                <span class="n">shared_generation_parameters</span><span class="p">[</span>
                    <span class="s2">&quot;base_image_uri&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">base_image</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">base_image</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">}</span>
                <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;base_image_hash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span>
                    <span class="n">base_image</span><span class="o">.</span><span class="n">_image_bytes</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="n">shared_generation_parameters</span><span class="p">[</span>
                    <span class="s2">&quot;mask_uri&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
                    <span class="p">},</span>
                <span class="p">}</span>
                <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;mask_hash&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span>
                    <span class="n">mask</span><span class="o">.</span><span class="n">_image_bytes</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">aspect_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;aspectRatio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aspect_ratio</span>
        <span class="k">elif</span> <span class="n">max_size</span><span class="p">:</span>
            <span class="c1"># Note: The size needs to be a string</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;sampleImageSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">height</span> <span class="o">!=</span> <span class="n">width</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;aspectRatio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;sampleCount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">number_of_images</span>
        <span class="k">if</span> <span class="n">negative_prompt</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;negativePrompt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">negative_prompt</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;negative_prompt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">negative_prompt</span>

        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Note: String seed and numerical seed give different results</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seed</span>

        <span class="k">if</span> <span class="n">guidance_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;guidanceScale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guidance_scale</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;guidance_scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">guidance_scale</span>

        <span class="k">if</span> <span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">language</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">language</span>

        <span class="k">if</span> <span class="n">output_gcs_uri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;storageUri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_gcs_uri</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;storage_uri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_gcs_uri</span>

        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">edit_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">][</span><span class="s2">&quot;editMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edit_mode</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;edit_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edit_mode</span>

        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">edit_mode</span> <span class="o">!=</span> <span class="s2">&quot;product-image&quot;</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">][</span><span class="s2">&quot;maskMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">mask_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">][</span><span class="s2">&quot;maskMode&quot;</span><span class="p">][</span><span class="s2">&quot;maskType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_mode</span>
                <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;mask_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_mode</span>

            <span class="k">if</span> <span class="n">segmentation_classes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">][</span><span class="s2">&quot;maskMode&quot;</span><span class="p">][</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segmentation_classes</span>
                <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segmentation_classes</span>

        <span class="k">if</span> <span class="n">mask_dilation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">][</span><span class="s2">&quot;maskDilation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_dilation</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;mask_dilation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_dilation</span>

        <span class="k">if</span> <span class="n">product_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;editConfig&quot;</span><span class="p">][</span><span class="s2">&quot;productPosition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_position</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;product_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_position</span>

        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;outputOptions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">output_mime_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;outputOptions&quot;</span><span class="p">][</span><span class="s2">&quot;mimeType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_mime_type</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;mime_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_mime_type</span>

        <span class="k">if</span> <span class="n">compression_quality</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;outputOptions&quot;</span><span class="p">][</span><span class="s2">&quot;compressionQuality&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compression_quality</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;compression_quality&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compression_quality</span>

        <span class="k">if</span> <span class="n">add_watermark</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;addWatermark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_watermark</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;add_watermark&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_watermark</span>

        <span class="k">if</span> <span class="n">safety_filter_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;safetySetting&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">safety_filter_level</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;safety_filter_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">safety_filter_level</span>

        <span class="k">if</span> <span class="n">person_generation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;personGeneration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">person_generation</span>
            <span class="n">shared_generation_parameters</span><span class="p">[</span><span class="s2">&quot;person_generation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">person_generation</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">instance</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">generated_images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;GeneratedImage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">):</span>
            <span class="n">generation_parameters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">shared_generation_parameters</span><span class="p">)</span>
            <span class="n">generation_parameters</span><span class="p">[</span><span class="s2">&quot;index_of_image_in_batch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="n">encoded_bytes</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">)</span>
            <span class="n">generated_image</span> <span class="o">=</span> <span class="n">GeneratedImage</span><span class="p">(</span>
                <span class="n">image_bytes</span><span class="o">=</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encoded_bytes</span><span class="p">)</span> <span class="k">if</span> <span class="n">encoded_bytes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">generation_parameters</span><span class="o">=</span><span class="n">generation_parameters</span><span class="p">,</span>
                <span class="n">gcs_uri</span><span class="o">=</span><span class="n">prediction</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gcsUri&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">generated_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generated_image</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ImageGenerationResponse</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">generated_images</span><span class="p">)</span>

<div class="viewcode-block" id="ImageGenerationModel.generate_images"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageGenerationModel.generate_images">[docs]</a>    <span class="k">def</span> <span class="nf">generate_images</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">negative_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">number_of_images</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">aspect_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;1:1&quot;</span><span class="p">,</span> <span class="s2">&quot;9:16&quot;</span><span class="p">,</span> <span class="s2">&quot;16:9&quot;</span><span class="p">,</span> <span class="s2">&quot;4:3&quot;</span><span class="p">,</span> <span class="s2">&quot;3:4&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">guidance_scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">add_watermark</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">safety_filter_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;block_most&quot;</span><span class="p">,</span> <span class="s2">&quot;block_some&quot;</span><span class="p">,</span> <span class="s2">&quot;block_few&quot;</span><span class="p">,</span> <span class="s2">&quot;block_fewest&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">person_generation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dont_allow&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_adult&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_all&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageGenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates images from text prompt.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt: Text prompt for the image.</span>
<span class="sd">            negative_prompt: A description of what you want to omit in the generated</span>
<span class="sd">                images.</span>
<span class="sd">            number_of_images: Number of images to generate. Range: 1..8.</span>
<span class="sd">            aspect_ratio: Changes the aspect ratio of the generated image Supported</span>
<span class="sd">                values are:</span>
<span class="sd">                * &quot;1:1&quot; : 1:1 aspect ratio</span>
<span class="sd">                * &quot;9:16&quot; : 9:16 aspect ratio</span>
<span class="sd">                * &quot;16:9&quot; : 16:9 aspect ratio</span>
<span class="sd">                * &quot;4:3&quot; : 4:3 aspect ratio</span>
<span class="sd">                * &quot;3:4&quot; : 3:4 aspect_ratio</span>
<span class="sd">            guidance_scale: Controls the strength of the prompt. Suggested values</span>
<span class="sd">                are:</span>
<span class="sd">                * 0-9 (low strength)</span>
<span class="sd">                * 10-20 (medium strength)</span>
<span class="sd">                * 21+ (high strength)</span>
<span class="sd">            language: Language of the text prompt for the image. Default: None.</span>
<span class="sd">                Supported values are `&quot;en&quot;` for English, `&quot;hi&quot;` for Hindi, `&quot;ja&quot;`</span>
<span class="sd">                for Japanese, `&quot;ko&quot;` for Korean, and `&quot;auto&quot;` for automatic language</span>
<span class="sd">                detection.</span>
<span class="sd">            seed: Image generation random seed.</span>
<span class="sd">            output_gcs_uri: Google Cloud Storage uri to store the generated images.</span>
<span class="sd">            add_watermark: Add a watermark to the generated image</span>
<span class="sd">            safety_filter_level: Adds a filter level to Safety filtering. Supported</span>
<span class="sd">                values are:</span>
<span class="sd">                * &quot;block_most&quot; : Strongest filtering level, most strict</span>
<span class="sd">                blocking</span>
<span class="sd">                * &quot;block_some&quot; : Block some problematic prompts and responses</span>
<span class="sd">                * &quot;block_few&quot; : Block fewer problematic prompts and responses</span>
<span class="sd">                * &quot;block_fewest&quot; : Block very few problematic prompts and responses</span>
<span class="sd">            person_generation: Allow generation of people by the model Supported</span>
<span class="sd">                values are:</span>
<span class="sd">                * &quot;dont_allow&quot; : Block generation of people</span>
<span class="sd">                * &quot;allow_adult&quot; : Generate adults, but not children</span>
<span class="sd">                * &quot;allow_all&quot; : Generate adults and children</span>
<span class="sd">        Returns:</span>
<span class="sd">            An `ImageGenerationResponse` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_images</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">negative_prompt</span><span class="o">=</span><span class="n">negative_prompt</span><span class="p">,</span>
            <span class="n">number_of_images</span><span class="o">=</span><span class="n">number_of_images</span><span class="p">,</span>
            <span class="n">aspect_ratio</span><span class="o">=</span><span class="n">aspect_ratio</span><span class="p">,</span>
            <span class="n">guidance_scale</span><span class="o">=</span><span class="n">guidance_scale</span><span class="p">,</span>
            <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
            <span class="n">output_gcs_uri</span><span class="o">=</span><span class="n">output_gcs_uri</span><span class="p">,</span>
            <span class="n">add_watermark</span><span class="o">=</span><span class="n">add_watermark</span><span class="p">,</span>
            <span class="n">safety_filter_level</span><span class="o">=</span><span class="n">safety_filter_level</span><span class="p">,</span>
            <span class="n">person_generation</span><span class="o">=</span><span class="n">person_generation</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ImageGenerationModel.edit_image"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageGenerationModel.edit_image">[docs]</a>    <span class="k">def</span> <span class="nf">edit_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_image</span><span class="p">:</span> <span class="s2">&quot;Image&quot;</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">negative_prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">number_of_images</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">guidance_scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">edit_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span>
                <span class="s2">&quot;inpainting-insert&quot;</span><span class="p">,</span> <span class="s2">&quot;inpainting-remove&quot;</span><span class="p">,</span> <span class="s2">&quot;outpainting&quot;</span><span class="p">,</span> <span class="s2">&quot;product-image&quot;</span>
            <span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;foreground&quot;</span><span class="p">,</span> <span class="s2">&quot;semantic&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">segmentation_classes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_dilation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">product_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;fixed&quot;</span><span class="p">,</span> <span class="s2">&quot;reposition&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_mime_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;image/png&quot;</span><span class="p">,</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compression_quality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">safety_filter_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;block_most&quot;</span><span class="p">,</span> <span class="s2">&quot;block_some&quot;</span><span class="p">,</span> <span class="s2">&quot;block_few&quot;</span><span class="p">,</span> <span class="s2">&quot;block_fewest&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">person_generation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dont_allow&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_adult&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_all&quot;</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ImageGenerationResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Edits an existing image based on text prompt.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt: Text prompt for the image.</span>
<span class="sd">            base_image: Base image from which to generate the new image.</span>
<span class="sd">            mask: Mask for the base image.</span>
<span class="sd">            negative_prompt: A description of what you want to omit in</span>
<span class="sd">                the generated images.</span>
<span class="sd">            number_of_images: Number of images to generate. Range: 1..8.</span>
<span class="sd">            guidance_scale: Controls the strength of the prompt.</span>
<span class="sd">                Suggested values are:</span>
<span class="sd">                * 0-9 (low strength)</span>
<span class="sd">                * 10-20 (medium strength)</span>
<span class="sd">                * 21+ (high strength)</span>
<span class="sd">            edit_mode: Describes the editing mode for the request. Supported values</span>
<span class="sd">                are:</span>
<span class="sd">                * inpainting-insert: fills the mask area based on the text prompt</span>
<span class="sd">                (requires mask and text)</span>
<span class="sd">                * inpainting-remove: removes the object(s) in the mask area.</span>
<span class="sd">                (requires mask)</span>
<span class="sd">                * outpainting: extend the image based on the mask area.</span>
<span class="sd">                (Requires mask)</span>
<span class="sd">                * product-image: Changes the background for the predominant product</span>
<span class="sd">                or subject in the image</span>
<span class="sd">            segmentation_classes: List of class IDs for segmentation. Max of 5 IDs</span>
<span class="sd">            mask_mode: Solicits generation of the mask (v/s providing mask as an</span>
<span class="sd">                input). Supported values are:</span>
<span class="sd">                * background: Automatically generates a mask for all regions except</span>
<span class="sd">                the primary subject(s) of the image</span>
<span class="sd">                * foreground: Automatically generates a mask for the primary</span>
<span class="sd">                subjects(s) of the image.</span>
<span class="sd">                * semantic: Segment one or more of the segmentation classes using</span>
<span class="sd">                class ID</span>
<span class="sd">            mask_dilation: Defines the dilation percentage of the mask provided.</span>
<span class="sd">                Float between 0 and 1. Defaults to 0.03</span>
<span class="sd">            product_position: Defines whether the product should stay fixed or be</span>
<span class="sd">                repositioned. Supported Values:</span>
<span class="sd">                * fixed: Fixed position</span>
<span class="sd">                * reposition: Can be moved (default)</span>
<span class="sd">            output_mime_type: Which image format should the output be saved as.</span>
<span class="sd">                Supported values:</span>
<span class="sd">                * image/png: Save as a PNG image</span>
<span class="sd">                * image/jpeg: Save as a JPEG image</span>
<span class="sd">            compression_quality: Level of compression if the output mime type is</span>
<span class="sd">              selected to be image/jpeg. Float between 0 to 100</span>
<span class="sd">            language: Language of the text prompt for the image. Default: None.</span>
<span class="sd">                Supported values are `&quot;en&quot;` for English, `&quot;hi&quot;` for Hindi,</span>
<span class="sd">                `&quot;ja&quot;` for Japanese, `&quot;ko&quot;` for Korean, and `&quot;auto&quot;` for</span>
<span class="sd">                automatic language detection.</span>
<span class="sd">            seed: Image generation random seed.</span>
<span class="sd">            output_gcs_uri: Google Cloud Storage uri to store the edited images.</span>
<span class="sd">            safety_filter_level: Adds a filter level to Safety filtering. Supported</span>
<span class="sd">                values are:</span>
<span class="sd">                * &quot;block_most&quot; : Strongest filtering level, most strict</span>
<span class="sd">                blocking</span>
<span class="sd">                * &quot;block_some&quot; : Block some problematic prompts and responses</span>
<span class="sd">                * &quot;block_few&quot; : Block fewer problematic prompts and responses</span>
<span class="sd">                * &quot;block_fewest&quot; : Block very few problematic prompts and responses</span>
<span class="sd">            person_generation: Allow generation of people by the model Supported</span>
<span class="sd">                values are:</span>
<span class="sd">                * &quot;dont_allow&quot; : Block generation of people</span>
<span class="sd">                * &quot;allow_adult&quot; : Generate adults, but not children</span>
<span class="sd">                * &quot;allow_all&quot; : Generate adults and children</span>

<span class="sd">        Returns:</span>
<span class="sd">            An `ImageGenerationResponse` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_images</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">negative_prompt</span><span class="o">=</span><span class="n">negative_prompt</span><span class="p">,</span>
            <span class="n">number_of_images</span><span class="o">=</span><span class="n">number_of_images</span><span class="p">,</span>
            <span class="n">guidance_scale</span><span class="o">=</span><span class="n">guidance_scale</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
            <span class="n">base_image</span><span class="o">=</span><span class="n">base_image</span><span class="p">,</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
            <span class="n">edit_mode</span><span class="o">=</span><span class="n">edit_mode</span><span class="p">,</span>
            <span class="n">mask_mode</span><span class="o">=</span><span class="n">mask_mode</span><span class="p">,</span>
            <span class="n">segmentation_classes</span><span class="o">=</span><span class="n">segmentation_classes</span><span class="p">,</span>
            <span class="n">mask_dilation</span><span class="o">=</span><span class="n">mask_dilation</span><span class="p">,</span>
            <span class="n">product_position</span><span class="o">=</span><span class="n">product_position</span><span class="p">,</span>
            <span class="n">output_mime_type</span><span class="o">=</span><span class="n">output_mime_type</span><span class="p">,</span>
            <span class="n">compression_quality</span><span class="o">=</span><span class="n">compression_quality</span><span class="p">,</span>
            <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">,</span>
            <span class="n">output_gcs_uri</span><span class="o">=</span><span class="n">output_gcs_uri</span><span class="p">,</span>
            <span class="n">add_watermark</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Not supported for editing yet</span>
            <span class="n">safety_filter_level</span><span class="o">=</span><span class="n">safety_filter_level</span><span class="p">,</span>
            <span class="n">person_generation</span><span class="o">=</span><span class="n">person_generation</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ImageGenerationModel.upscale_image"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageGenerationModel.upscale_image">[docs]</a>    <span class="k">def</span> <span class="nf">upscale_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;Image&quot;</span><span class="p">,</span> <span class="s2">&quot;GeneratedImage&quot;</span><span class="p">],</span>
        <span class="n">new_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
        <span class="n">output_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Image&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upscales an image.</span>

<span class="sd">        This supports upscaling images generated through the `generate_images()` method,</span>
<span class="sd">        or upscaling a new image that is 1024x1024.</span>

<span class="sd">        Examples::</span>

<span class="sd">            # Upscale a generated image</span>
<span class="sd">            model = ImageGenerationModel.from_pretrained(&quot;imagegeneration@002&quot;)</span>
<span class="sd">            response = model.generate_images(</span>
<span class="sd">                prompt=&quot;Astronaut riding a horse&quot;,</span>
<span class="sd">            )</span>
<span class="sd">            model.upscale_image(image=response[0])</span>

<span class="sd">            # Upscale a new 1024x1024 image</span>
<span class="sd">            my_image = Image.load_from_file(&quot;my-image.png&quot;)</span>
<span class="sd">            model.upscale_image(image=my_image)</span>

<span class="sd">        Args:</span>
<span class="sd">            image (Union[GeneratedImage, Image]):</span>
<span class="sd">                Required. The generated image to upscale.</span>
<span class="sd">            new_size (int):</span>
<span class="sd">                The size of the biggest dimension of the upscaled image. Only 2048 and 4096 are currently</span>
<span class="sd">                supported. Results in a 2048x2048 or 4096x4096 image. Defaults to 2048 if not provided.</span>
<span class="sd">            output_gcs_uri: Google Cloud Storage uri to store the upscaled images.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An `Image` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Currently this method only supports 1024x1024 images</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1024</span> <span class="ow">and</span> <span class="n">image</span><span class="o">.</span><span class="n">_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Upscaling is currently only supported on images that are 1024x1024.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">new_size</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_SUPPORTED_UPSCALING_SIZES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Only the folowing square upscaling sizes are currently supported: </span><span class="si">{</span><span class="n">_SUPPORTED_UPSCALING_SIZES</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="p">}</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sampleImageSize&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_size</span><span class="p">),</span>
            <span class="s2">&quot;sampleCount&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;upscale&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">output_gcs_uri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;storageUri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_gcs_uri</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">instance</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">upscaled_image</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">GeneratedImage</span><span class="p">):</span>
            <span class="n">generation_parameters</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">generation_parameters</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">generation_parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">generation_parameters</span><span class="p">[</span><span class="s2">&quot;upscaled_image_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_size</span>

        <span class="n">encoded_bytes</span> <span class="o">=</span> <span class="n">upscaled_image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GeneratedImage</span><span class="p">(</span>
            <span class="n">image_bytes</span><span class="o">=</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encoded_bytes</span><span class="p">)</span> <span class="k">if</span> <span class="n">encoded_bytes</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">generation_parameters</span><span class="o">=</span><span class="n">generation_parameters</span><span class="p">,</span>
            <span class="n">gcs_uri</span><span class="o">=</span><span class="n">upscaled_image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;gcsUri&quot;</span><span class="p">),</span>
        <span class="p">)</span></div>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">ImageGenerationResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Image generation response.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        images: The list of generated images.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.preview.vision_models&quot;</span>

    <span class="n">images</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;GeneratedImage&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="ImageGenerationResponse.__iter__"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageGenerationResponse.__iter__">[docs]</a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterator</span><span class="p">[</span><span class="s2">&quot;GeneratedImage&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterates through the generated images.&quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span></div>

<div class="viewcode-block" id="ImageGenerationResponse.__getitem__"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageGenerationResponse.__getitem__">[docs]</a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GeneratedImage&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the generated image by index.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>


<span class="n">_EXIF_USER_COMMENT_TAG_IDX</span> <span class="o">=</span> <span class="mh">0x9286</span>
<span class="n">_IMAGE_GENERATION_PARAMETERS_EXIF_KEY</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;google.cloud.vertexai.image_generation.image_generation_parameters&quot;</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">GeneratedImage</span><span class="p">(</span><span class="n">Image</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generated image.&quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.preview.vision_models&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_bytes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span>
        <span class="n">generation_parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `GeneratedImage` object.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_bytes: Image file bytes. Image can be in PNG or JPEG format.</span>
<span class="sd">            generation_parameters: Image generation parameter values.</span>
<span class="sd">            gcs_uri: Image file Google Cloud Storage uri.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">image_bytes</span><span class="o">=</span><span class="n">image_bytes</span><span class="p">,</span> <span class="n">gcs_uri</span><span class="o">=</span><span class="n">gcs_uri</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_generation_parameters</span> <span class="o">=</span> <span class="n">generation_parameters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">generation_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Image generation parameters as a dictionary.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generation_parameters</span>

<div class="viewcode-block" id="GeneratedImage.load_from_file"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.GeneratedImage.load_from_file">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GeneratedImage&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads image from file.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path from where to load the image.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Loaded image as a `GeneratedImage` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="n">exif</span> <span class="o">=</span> <span class="n">base_image</span><span class="o">.</span><span class="n">_pil_image</span><span class="o">.</span><span class="n">getexif</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">exif_comment_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">exif</span><span class="p">[</span><span class="n">_EXIF_USER_COMMENT_TAG_IDX</span><span class="p">])</span>
        <span class="n">generation_parameters</span> <span class="o">=</span> <span class="n">exif_comment_dict</span><span class="p">[</span><span class="n">_IMAGE_GENERATION_PARAMETERS_EXIF_KEY</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">GeneratedImage</span><span class="p">(</span>
            <span class="n">image_bytes</span><span class="o">=</span><span class="n">base_image</span><span class="o">.</span><span class="n">_image_bytes</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="n">generation_parameters</span><span class="o">=</span><span class="n">generation_parameters</span><span class="p">,</span>
            <span class="n">gcs_uri</span><span class="o">=</span><span class="n">base_image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">,</span>  <span class="c1"># pylint: disable=protected-access</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="GeneratedImage.save"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.GeneratedImage.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">include_generation_parameters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves image to a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            location: Local path where to save the image.</span>
<span class="sd">            include_generation_parameters: Whether to include the image</span>
<span class="sd">                generation parameters in the image&#39;s EXIF metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include_generation_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generation_parameters</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Image does not have generation parameters.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">PIL_Image</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The PIL module is required for saving generation parameters.&quot;</span>
                <span class="p">)</span>

            <span class="n">exif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pil_image</span><span class="o">.</span><span class="n">getexif</span><span class="p">()</span>
            <span class="n">exif</span><span class="p">[</span><span class="n">_EXIF_USER_COMMENT_TAG_IDX</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="p">{</span><span class="n">_IMAGE_GENERATION_PARAMETERS_EXIF_KEY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generation_parameters</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pil_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">exif</span><span class="o">=</span><span class="n">exif</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">ImageCaptioningModel</span><span class="p">(</span>
    <span class="n">_model_garden_models</span><span class="o">.</span><span class="n">_ModelGardenModel</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates captions from image.</span>

<span class="sd">    Examples::</span>

<span class="sd">        model = ImageCaptioningModel.from_pretrained(&quot;imagetext@001&quot;)</span>
<span class="sd">        image = Image.load_from_file(&quot;image.png&quot;)</span>
<span class="sd">        captions = model.get_captions(</span>
<span class="sd">            image=image,</span>
<span class="sd">            # Optional:</span>
<span class="sd">            number_of_results=1,</span>
<span class="sd">            language=&quot;en&quot;,</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">_INSTANCE_SCHEMA_URI</span> <span class="o">=</span> <span class="s2">&quot;gs://google-cloud-aiplatform/schema/predict/instance/vision_reasoning_model_1.0.0.yaml&quot;</span>

<div class="viewcode-block" id="ImageCaptioningModel.get_captions"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageCaptioningModel.get_captions">[docs]</a>    <span class="k">def</span> <span class="nf">get_captions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">number_of_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
        <span class="n">output_gcs_uri</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates captions for a given image.</span>

<span class="sd">        Args:</span>
<span class="sd">            image: The image to get captions for. Size limit: 10 MB.</span>
<span class="sd">            number_of_results: Number of captions to produce. Range: 1-3.</span>
<span class="sd">            language: Language to use for captions.</span>
<span class="sd">                Supported languages: &quot;en&quot;, &quot;fr&quot;, &quot;de&quot;, &quot;it&quot;, &quot;es&quot;</span>
<span class="sd">            output_gcs_uri: Google Cloud Storage uri to store the captioned images.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of image caption strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="p">}</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sampleCount&quot;</span><span class="p">:</span> <span class="n">number_of_results</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="n">language</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">output_gcs_uri</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;storageUri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_gcs_uri</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">instance</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span></div>


<span class="k">class</span> <span class="nc">ImageQnAModel</span><span class="p">(</span>
    <span class="n">_model_garden_models</span><span class="o">.</span><span class="n">_ModelGardenModel</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Answers questions about an image.</span>

<span class="sd">    Examples::</span>

<span class="sd">        model = ImageQnAModel.from_pretrained(&quot;imagetext@001&quot;)</span>
<span class="sd">        image = Image.load_from_file(&quot;image.png&quot;)</span>
<span class="sd">        answers = model.ask_question(</span>
<span class="sd">            image=image,</span>
<span class="sd">            question=&quot;What color is the car in this image?&quot;,</span>
<span class="sd">            # Optional:</span>
<span class="sd">            number_of_results=1,</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">_INSTANCE_SCHEMA_URI</span> <span class="o">=</span> <span class="s2">&quot;gs://google-cloud-aiplatform/schema/predict/instance/vision_reasoning_model_1.0.0.yaml&quot;</span>

<div class="viewcode-block" id="ImageQnAModel.ask_question"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.ImageQnAModel.ask_question">[docs]</a>    <span class="k">def</span> <span class="nf">ask_question</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">number_of_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Answers questions about an image.</span>

<span class="sd">        Args:</span>
<span class="sd">            image: The image to get captions for. Size limit: 10 MB.</span>
<span class="sd">            question: Question to ask about the image.</span>
<span class="sd">            number_of_results: Number of captions to produce. Range: 1-3.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of answers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">question</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
            <span class="p">}</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sampleCount&quot;</span><span class="p">:</span> <span class="n">number_of_results</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">instance</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span></div>


<span class="k">class</span> <span class="nc">MultiModalEmbeddingModel</span><span class="p">(</span><span class="n">_model_garden_models</span><span class="o">.</span><span class="n">_ModelGardenModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates embedding vectors from images and videos.</span>

<span class="sd">    Examples::</span>

<span class="sd">        model = MultiModalEmbeddingModel.from_pretrained(&quot;multimodalembedding@001&quot;)</span>
<span class="sd">        image = Image.load_from_file(&quot;image.png&quot;)</span>
<span class="sd">        video = Video.load_from_file(&quot;video.mp4&quot;)</span>

<span class="sd">        embeddings = model.get_embeddings(</span>
<span class="sd">            image=image,</span>
<span class="sd">            video=video,</span>
<span class="sd">            contextual_text=&quot;Hello world&quot;,</span>
<span class="sd">        )</span>
<span class="sd">        image_embedding = embeddings.image_embedding</span>
<span class="sd">        video_embeddings = embeddings.video_embeddings</span>
<span class="sd">        text_embedding = embeddings.text_embedding</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">_INSTANCE_SCHEMA_URI</span> <span class="o">=</span> <span class="s2">&quot;gs://google-cloud-aiplatform/schema/predict/instance/vision_embedding_model_1.0.0.yaml&quot;</span>

<div class="viewcode-block" id="MultiModalEmbeddingModel.get_embeddings"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.MultiModalEmbeddingModel.get_embeddings">[docs]</a>    <span class="k">def</span> <span class="nf">get_embeddings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">video</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Video</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">contextual_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dimension</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">video_segment_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoSegmentConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MultiModalEmbeddingResponse&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets embedding vectors from the provided image.</span>

<span class="sd">        Args:</span>
<span class="sd">            image (Image): Optional. The image to generate embeddings for. One of</span>
<span class="sd">              `image`, `video`, or `contextual_text` is required.</span>
<span class="sd">            video (Video): Optional. The video to generate embeddings for. One of</span>
<span class="sd">              `image`, `video` or `contextual_text` is required.</span>
<span class="sd">            contextual_text (str): Optional. Contextual text for your input image or video.</span>
<span class="sd">              If provided, the model will also generate an embedding vector for the</span>
<span class="sd">              provided contextual text. The returned image and text embedding</span>
<span class="sd">              vectors are in the same semantic space with the same dimensionality,</span>
<span class="sd">              and the vectors can be used interchangeably for use cases like</span>
<span class="sd">              searching image by text or searching text by image. One of `image`, `video` or</span>
<span class="sd">              `contextual_text` is required.</span>
<span class="sd">            dimension (int): Optional. The number of embedding dimensions. Lower</span>
<span class="sd">              values offer decreased latency when using these embeddings for</span>
<span class="sd">              subsequent tasks, while higher values offer better accuracy.</span>
<span class="sd">              Available values: `128`, `256`, `512`, and `1408` (default).</span>
<span class="sd">            video_segment_config (VideoSegmentConfig): Optional. The specific</span>
<span class="sd">              video segments (in seconds) the embeddings are generated for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            MultiModalEmbeddingResponse:</span>
<span class="sd">                The image and text embedding vectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">video</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">contextual_text</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;One of `image`, `video`, or `contextual_text` is required.&quot;</span>
            <span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">}</span>

        <span class="k">if</span> <span class="n">video</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">video</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">video</span><span class="o">.</span><span class="n">_gcs_uri</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">video</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="p">}</span>  <span class="c1"># pylint: disable=protected-access</span>

            <span class="k">if</span> <span class="n">video_segment_config</span><span class="p">:</span>
                <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;video&quot;</span><span class="p">][</span><span class="s2">&quot;videoSegmentConfig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;startOffsetSec&quot;</span><span class="p">:</span> <span class="n">video_segment_config</span><span class="o">.</span><span class="n">start_offset_sec</span><span class="p">,</span>
                    <span class="s2">&quot;endOffsetSec&quot;</span><span class="p">:</span> <span class="n">video_segment_config</span><span class="o">.</span><span class="n">end_offset_sec</span><span class="p">,</span>
                    <span class="s2">&quot;intervalSec&quot;</span><span class="p">:</span> <span class="n">video_segment_config</span><span class="o">.</span><span class="n">interval_sec</span><span class="p">,</span>
                <span class="p">}</span>

        <span class="k">if</span> <span class="n">contextual_text</span><span class="p">:</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contextual_text</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">dimension</span><span class="p">:</span>
            <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;dimension&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dimension</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">instance</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">image_embedding</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;imageEmbedding&quot;</span><span class="p">)</span>
        <span class="n">video_embeddings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">video_embedding</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;videoEmbeddings&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">video_embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">VideoEmbedding</span><span class="p">(</span>
                    <span class="n">embedding</span><span class="o">=</span><span class="n">video_embedding</span><span class="p">[</span><span class="s2">&quot;embedding&quot;</span><span class="p">],</span>
                    <span class="n">start_offset_sec</span><span class="o">=</span><span class="n">video_embedding</span><span class="p">[</span><span class="s2">&quot;startOffsetSec&quot;</span><span class="p">],</span>
                    <span class="n">end_offset_sec</span><span class="o">=</span><span class="n">video_embedding</span><span class="p">[</span><span class="s2">&quot;endOffsetSec&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">text_embedding</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;textEmbedding&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;textEmbedding&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">MultiModalEmbeddingResponse</span><span class="p">(</span>
            <span class="n">image_embedding</span><span class="o">=</span><span class="n">image_embedding</span><span class="p">,</span>
            <span class="n">video_embeddings</span><span class="o">=</span><span class="n">video_embeddings</span><span class="p">,</span>
            <span class="n">_prediction_response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
            <span class="n">text_embedding</span><span class="o">=</span><span class="n">text_embedding</span><span class="p">,</span>
        <span class="p">)</span></div>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">MultiModalEmbeddingResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The multimodal embedding response.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        image_embedding (List[float]):</span>
<span class="sd">            Optional. The embedding vector generated from your image.</span>
<span class="sd">        video_embeddings (List[VideoEmbedding]):</span>
<span class="sd">            Optional. The embedding vectors generated from your video.</span>
<span class="sd">        text_embedding (List[float]):</span>
<span class="sd">            Optional. The embedding vector generated from the contextual text provided for your image or video.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="n">_prediction_response</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">image_embedding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">video_embeddings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">VideoEmbedding</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">text_embedding</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">ImageTextModel</span><span class="p">(</span><span class="n">ImageCaptioningModel</span><span class="p">,</span> <span class="n">ImageQnAModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates text from images.</span>

<span class="sd">    Examples::</span>

<span class="sd">        model = ImageTextModel.from_pretrained(&quot;imagetext@001&quot;)</span>
<span class="sd">        image = Image.load_from_file(&quot;image.png&quot;)</span>

<span class="sd">        captions = model.get_captions(</span>
<span class="sd">            image=image,</span>
<span class="sd">            # Optional:</span>
<span class="sd">            number_of_results=1,</span>
<span class="sd">            language=&quot;en&quot;,</span>
<span class="sd">        )</span>

<span class="sd">        answers = model.ask_question(</span>
<span class="sd">            image=image,</span>
<span class="sd">            question=&quot;What color is the car in this image?&quot;,</span>
<span class="sd">            # Optional:</span>
<span class="sd">            number_of_results=1,</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.vision_models&quot;</span>

    <span class="c1"># NOTE: Using this ImageTextModel class is recommended over using ImageQnAModel or ImageCaptioningModel,</span>
    <span class="c1"># since SDK Model Garden classes should follow the design pattern of exactly 1 SDK class to 1 Model Garden schema URI</span>

    <span class="n">_INSTANCE_SCHEMA_URI</span> <span class="o">=</span> <span class="s2">&quot;gs://google-cloud-aiplatform/schema/predict/instance/vision_reasoning_model_1.0.0.yaml&quot;</span>


<span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">WatermarkVerificationResponse</span><span class="p">:</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.preview.vision_models&quot;</span>

    <span class="n">_prediction_response</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">watermark_verification_result</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">WatermarkVerificationModel</span><span class="p">(</span><span class="n">_model_garden_models</span><span class="o">.</span><span class="n">_ModelGardenModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verifies if an image has a watermark&quot;&quot;&quot;</span>

    <span class="vm">__module__</span> <span class="o">=</span> <span class="s2">&quot;vertexai.preview.vision_models&quot;</span>

    <span class="n">_INSTANCE_SCHEMA_URI</span> <span class="o">=</span> <span class="s2">&quot;gs://google-cloud-aiplatform/schema/predict/instance/watermark_verification_model_1.0.0.yaml&quot;</span>

<div class="viewcode-block" id="WatermarkVerificationModel.verify_image"><a class="viewcode-back" href="../../../vertexai/services.html#vertexai.vision_models.WatermarkVerificationModel.verify_image">[docs]</a>    <span class="k">def</span> <span class="nf">verify_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WatermarkVerificationResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verifies the watermark of an image.</span>

<span class="sd">        Args:</span>
<span class="sd">            image: The image to verify.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A WatermarkVerificationResponse, containing the confidence level of</span>
<span class="sd">            the image being watermarked.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Image is required.&quot;</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">:</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gcsUri&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_gcs_uri</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instance</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bytesBase64Encoded&quot;</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">_as_base64_string</span><span class="p">()}</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endpoint</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
            <span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">instance</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">verification_likelihood</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;decision&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">WatermarkVerificationResponse</span><span class="p">(</span>
            <span class="n">_prediction_response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
            <span class="n">watermark_verification_result</span><span class="o">=</span><span class="n">verification_likelihood</span><span class="p">,</span>
        <span class="p">)</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">google-cloud-aiplatform</a></h1>



<p class="blurb">Google Cloud Client Libraries for google-cloud-aiplatform</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=googleapis&repo=python-aiplatform&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../vertexai/services.html">Vertex AI SDK</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  <li><a href="../vision_models.html">vertexai.vision_models</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, Google.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    
    <a href="https://github.com/googleapis/python-aiplatform" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>